Comment: ASCOM Platform installation script
Comment: NOTE: The required Platform version number is read at build time by this script from the MasterPlatformVersion.txt file that is maintained through the main Visual Studio project
 
Comment: The installer must be started in 32bit MSI mode
Set Variable NATIVE_ENGINE to FALSE
Set Win32 - Native 32 bit Windows and Windows 32 on Windows 64 (WOW64) - installation mode
 
Comment: Set the required minimum Visual C Runtime version number
Set Variable MINIMUM_VC_RUNTIME_VERSION to 14.32.31332.0
 
[DEFINE REGION: Set up log file and variables]
Comment: Define variables, create the directory and log file name.
Set Variable SETUPLOG to 
Get Folder Location My->My Documents into MYDOCUMENTS
Get Free Space on C: into variable DISKSPACE
 
Comment: Suppress InstallAware branding in dialogues
Set Variable MYAHLOGO to TRUE
 
Comment: Set the dialogue transition style: Empty / FADE / SLIDE
Set Variable FX to 
Set Variable MYPROGRESS to 0
Set Variable PROGRESSTEXT to Installing $TITLE$
Set Variable APPLYINSTALLSUCCESS to 
Set Variable CFA to 
Set Variable CFABYPASS to 
 
Comment: Create the path to the setup log and create the ASCOM directory, which must exist or the following write into text file commands fail
Run Program CMD.EXE /c MKDIR "$MYDOCUMENTS$ASCOM" (WAIT)
 
Comment: Create the correct log name depending on whether we are installing or uninstalling
if Variable REMOVE Equals (Ignore Case) TRUE
  Set Variable SETUPLOG to $MYDOCUMENTS$ASCOM\ASCOMPlatform6Remove$DISKSPACE$.txt
else
  Set Variable SETUPLOG to $MYDOCUMENTS$ASCOM\ASCOMPlatform6Install$DISKSPACE$.txt
end
Write into Text File $SETUPLOG$ from Value $TIME$ $TITLE$ v$VERSION$ (at end of file)
 
Comment: Test whether Controlled Folder Access is enabled and warn the user if this is the case
if Variable CFABYPASS not Equals (Ignore Case) TRUE
  Comment: Check whether CFA is enabled: The test is made by trying to open the installer's log file and reading the first line. If this is blank there is no log file and CFA is active on the Documents folder
  Read from Text File $SETUPLOG$ into Variable CFA
  if Variable CFA Equals 
    Comment: The read returned a blank line instead of the Platform version number so CFA is deemed to be active
    MessageBox: Unable to write to Documents folder, The installer cannot write to your Documents folder, you may have Microsoft Controlled Folder Access enabled or you may be running anti-ransomware software on this PC.$NEWLINE$$NEWLINE$Folder: $MYDOCUMENTS$$NEWLINE$$NEWLINE$The Platform's complex installation process cannot proceed without write access to create its multiple log files and is highly likely to display error messages and fail to complete successfully.$NEWLINE$$NEWLINE$At this time, the only way to install the Platform on a protected PC is to disable CFA or ransomware protection, to run the Platform installer and then to re-enable protection.$NEWLINE$$NEWLINE$Click "No" to terminate installation or click "Yes" to try anyway.
     
    Comment: The MessageBox returns its result in the CFA variable...
    if Variable CFA Equals NO
      Comment: Terminate the installation because we cannot continue with installation without write access to the Documents folder.
      Terminate Installation
    end
  end
else
  MessageBox: CFA Detection Bypass, CFA check bypassed.$NEWLINE$$NEWLINE$The installer log file will be written to: $NEWLINE$$NEWLINE$$SETUPLOG$$NEWLINE$$NEWLINE$Documents: $NEWLINE$$NEWLINE$$MYDOCUMENTS$
end
 
Write into Text File $SETUPLOG$ from Value $TIME$ Installation date: $DATE$ (at end of file)
Write into Text File $SETUPLOG$ from Value   (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Setup path: $SETUPPATH$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Support directory: $SUPPORTDIR$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Installer: $EXEFILE$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Engine cache: $ENGINECACHE$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ MSI file: $MSIFILE$ (at end of file)
Write into Text File $SETUPLOG$ from Value   (at end of file)
 
Comment: Run the RemoveASCOM program if requested on the command line
if Variable CMDLINE Contains (Ignore Case) /RemoveASCOM
  Write into Text File $SETUPLOG$ from Value $TIME$ $TITLE$ Command line contains /RemoveASCOM : $CMDLINE$ (at end of file)
  Comment: Run the RemoveASCOM program
  Run Program $SUPPORTDIR$\RemoveAscom.exe $REVISIONCODE$ (WAIT, get result into variable ERROROLD)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $ERROROLD$ - RemoveASCOM (at end of file)
   
  if Variable ERROROLD Equals 99
    Comment: User ran ForceRemove but chose NOT to remove the Platform so give them a message and terminate the installer
    Write into Text File $SETUPLOG$ from Value $TIME$ Terminating install. (at end of file)
    MessageBox: Unable to uninstall current Platform, You chose not to force Platform removal and this installer will close when you click "OK".
  else
    Comment: We've forcibly removed the Platform and Profile store so now we just terminate ready for another installation
    Write into Text File $SETUPLOG$ from Value $TIME$ Platform uninstaller run completed, (at end of file)
    MessageBox: Platform Removed, The ASCOM Platform has been removed, the installer will now termiinate. Please run the installer again, without command line parameters, to install the Platform normally.
  end
  Comment: Terminate Installation
  GoTo Label: End of Script
end
 
Comment: Set current leap second value
Set Variable LEAPSECONDS to 37
 
Comment: Initialize setup variables
Set Variable ASCOMERROR to 
Set Variable PLATFORMVERSIONMAJOR to 
Set Variable PLATFORMVERSIONMINOR to 
Set Variable PLATFORMVERSIONSPNUMBER to 
Set Variable ERROROLD to 
Set Variable UNINSTALLCODE to 
Set Variable WINERRORUISTATE to 
Set Variable WINERRORUISTATENEW to 
Set Variable TERMINATEINSTALL to FALSE
Set Variable UNINSTALLER to 
Set Variable SUCCESS to 
Set Variable SUCCESS64 to 
Set Variable LASTERROR to 
Set Variable INSTALLCACHEEXISTS to 
Set Variable INSTALLCACHEDIRECTORY to 
Set Variable VC32_REBOOT_REQUIRED to 
Set Variable VC64_REBOOT_REQUIRED to 
 
Comment: Component installed state variables
Set Variable INSTALL_PLATFORM to 
Set Variable INSTALL_DIAGNOSTICS_SHORTCUT_ON_DESKTOP to 
Set Variable INSTALL_PROFILE_EXPLORER_SHORTCUT_ON_DESKTOP to 
Set Variable DISPLAY_USER_GUIDE to 
Set Variable INSTALL_POTH to 
Set Variable INSTALL_DOMECONTROLHUB to 
Set Variable INSTALL_PIPE to 
Set Variable INSTALL_HUB to 
 
Comment: Set up values for a 32bit OS
Set Variable PROGRAMFILES32 to 
Set Variable COMMONFILES32 to 
 
Comment: Set up values for a 64bit OS
Set Variable PROGRAMFILES64 to 
Set Variable COMMONFILES64 to 
Set Variable WIN64MODE to 
Set Variable ARM64MODE to 
Set Variable PROGRAMDATA to 
Get System Setting Windows in 64 bit Mode into WIN64MODE
 
Comment: If the system reports 32bit, check whether we are running on a 64bit ARM chip with 64bit Intel emulation. E.g. A Parallels VM running on Apple silicon.
if Variable WIN64MODE Equals FALSE
  Comment: Get an indicator showing whether we are running on ARM64 with Intel emulation.
  Get System Setting Windows on ARM with AMD64/EM64T Emulation into ARM64MODE
  if Variable ARM64MODE Equals TRUE
    Comment: Set the 64bit flag because we are running on a 64bit ARM processor running Windows.
    Set Variable WIN64MODE to TRUE
    Write into Text File $SETUPLOG$ from Value $TIME$ Setting WIN64MODE to TRUE because we are running on a 64bit ARM processor with Intel 64bit extension emulation: $WIN64MODE$ (at end of file)
    Write into Text File $SETUPLOG$ from Value   (at end of file)
  end
end
 
Comment: Force 64bit mode if required
if Variable CMDLINE Contains (Ignore Case) /Force64Bit
  Set Variable WIN64MODE to TRUE
  Write into Text File $SETUPLOG$ from Value $TIME$ Command line contains /Force64Bit : $CMDLINE$ (at end of file)
  Write into Text File $SETUPLOG$ from Value $TIME$ Forcing 64bit installation - WIN64MODE has been set to $WIN64MODE$ (at end of file)
  Write into Text File $SETUPLOG$ from Value   (at end of file)
end
 
Comment: Determine whether install is from the installer executable or from the Windows control panel application installation / modification dialogue
Set Variable INSTALLMETHOD to 
if Variable SETUPPATH Contains (Ignore Case) \ProgramData
  Set Variable INSTALLMETHOD to CONTROLPANEL
  Comment: Message to be displayed when repairing an installation using the Windows Control Panel
  Set Variable REPAIR_MESSAGE to If this repair fails, try using the Platform installer to repair the installation
else
  Set Variable INSTALLMETHOD to EXECUTABLE
  Comment: Message to be displayed when repairing an installation using the Platform installer
  Set Variable REPAIR_MESSAGE to If this repair fails, uninstall the Platform, reboot and re-run the installer
end
 
Comment: Set up values for OS version information
Set Variable OPSYS to 
Set Variable WIN10ORLATER to 
Set Variable INSTALLNET35 to 
Set Variable OSCURRENTVERSION to 
Set Variable OSEDITIONID to 
Set Variable OSPRODUCTNAME to 
Set Variable OSCURRENTBUILD to 
Set Variable OSBUILDLABEL to 
Get Exact OS Level into OPSYS
 
Comment: Create variable that will indicate whether .NET 3.5 can be automatically enabled.
Set Variable AUTOUPDATENET35 to 
 
Comment: Initialise to a null value. These variables point at 32bit executables on both 32 and 64bit OS.
Get Folder Location System->Program Files Directory into PROGRAMFILES32
Get Common Folder Location System->Program Files Directory into COMMONFILES32
Set Variable REGASM32 to 
Set Variable NGEN32 to 
Set Variable FRAMEWORK to 
Set Variable FRAMEWORKPATH to 
Set Variable FRAMEWORK2 to v2.0.50727
Set Variable FRAMEWORK4 to v4.0.30319
Set Variable FRAMEWORK to $FRAMEWORK4$
 
Comment: Define components
Define Component: ASCOM Platform Options
Define Component: ASCOM Platform Options\Install Diagnostics shortcut on desktop
Define Component: ASCOM Platform Options\Install Profile Explorer shortcut on desktop
Define Component: ASCOM Platform Options\Display user guide when installation is complete
Define Component: Out of date hubs replaced by Device Hub
Define Component: Out of date hubs replaced by Device Hub\POTH
Define Component: Out of date hubs replaced by Device Hub\Dome Control Hub
Define Component: Out of date hubs replaced by Device Hub\Pipe
Define Component: Out of date hubs replaced by Device Hub\Hub
 
Comment: Read the framework root value from the OS and set FRAMEWORKPATH to the full path to the executables
Read Registry Key HKLM\SOFTWARE\Microsoft\.NETFramework\InstallRoot into FRAMEWORKROOT
Set Variable FRAMEWORKPATH to $FRAMEWORKROOT$$FRAMEWORK$
 
Comment: Set to values that will access the 32bit portion of the registry on a 64bit OS
Set Variable REGASM32 to $FRAMEWORKPATH$\regasm.exe
Set Variable NGEN32 to $FRAMEWORKPATH$\ngen.exe
 
Comment: Initialise to a null value that will access the correct portion of the registry on a 32bit OS
Set Variable REGASM64 to 
Set Variable NGEN64 to 
if Variable WIN64MODE Equals TRUE
  Set x64 - Native 64 bit Windows, AMD64, EM64T, and ARM64 Architectures - installation mode
  Get Folder Location System->Program Files Directory into PROGRAMFILES64
  Get Common Folder Location System->Program Files Directory into COMMONFILES64
  Set Win32 - Native 32 bit Windows and Windows 32 on Windows 64 (WOW64) - installation mode
  Comment: Set to a value that will access the 32bit portion of the registry on a 64bit OS
  Set Variable REGASM64 to $WINDIR$Microsoft.NET\Framework64\$FRAMEWORK$\regasm.exe
  Set Variable NGEN64 to $WINDIR$Microsoft.NET\Framework64\$FRAMEWORK$\ngen.exe
end
 
Comment: Setup up further global variables
Get System Setting Windows NT Kernel (NT4, 2000, XP, 2003, Vista, 2008 (R2), 7, 8.x, 2012 (R2), 10, 2016, 2019, 11, 2022) into ISNT
Get Folder Location System->Program Files Directory into PROGRAMFILES
Get Common Folder Location System->Application Data Directory into PROGRAMDATA
Get Common Folder Location System->Program Files Directory into COMMONFILES
Get Common Folder Location Start Menu->Programs Group into SHORTCUTFILESALL
Get Folder Location Start Menu->Programs Group into SHORTCUTFILES
if Variable SHORTCUTFILESALL Equals 
  Set Variable SHORTCUTFILESALL to $SHORTCUTFILES$
end
 
Comment: Setup up shortcut locations
if Variable ALLUSERS Equals (Ignore Case) TRUE
  Set Variable SHORTCUTFOLDER to $SHORTCUTFILESALL$$ASCOMSTARTMENU$
  Set Variable DESKTOPFOLDER to $DESKTOPDIRALL$
else
  Set Variable SHORTCUTFOLDER to $SHORTCUTFILES$$ASCOMSTARTMENU$
  Set Variable DESKTOPFOLDER to $DESKTOPDIR$
end
 
Get Folder Location System->Desktop Directory into DESKTOPDIR
Get Common Folder Location System->Desktop Directory into DESKTOPDIRALL
Get Folder Location System->Windows Directory into WINDIR
Get Folder Location System->System Directory into WINSYSDIR
Get Folder Location Taskbar->Quick Launch Directory into QUICKLAUNCHDIR
Get Folder Location WWW->WWWRoot into WWWROOTDIR
Read Registry Key HKLM\SOFTWARE\Microsoft\.NETFramework\InstallRoot into FRAMEWORKROOT
 
Comment: Read OS type information from registry
Read Registry Key HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\CurrentVersion into OSCURRENTVERSION
Read Registry Key HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\EditionID into OSEDITIONID
Read Registry Key HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProductName into OSPRODUCTNAME
Read Registry Key HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\CurrentBuild into OSCURRENTBUILD
Read Registry Key HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\BuildLabEx into OSBUILDLABEL
 
Comment: Determine if Acrobat is installed
Set Variable ACROBATKEY to 
Read Registry Key HKCR\.pdf\ into ACROBATKEY
 
Comment: Create the path to the GAC installer reference list
if Variable WIN64MODE Equals TRUE
  Set Variable GACREF to SOFTWARE\Wow6432Node\Microsoft\Fusion\References
else
  Set Variable GACREF to SOFTWARE\Microsoft\Fusion\References
end
 
Comment: Set  up start menu variables, ASCOMSTARTMENU is the name of the Platform folder
Set Variable ASCOMSTARTMENU to ASCOM Platform 6
Set Variable ALLUSERS to TRUE
 
Comment: Set the Target directory and start menu folder
Set Variable TARGETDIR to $PROGRAMFILES$ASCOM\Platform 6
Set Variable STARTMENU to $TITLE$
 
Comment: Set the installation cache location
Set Variable INSTALLCACHEDIRECTORY to $PROGRAMDATA$$REVISIONCODE$
 
Comment: Create the start of the installation log
Write into Text File $SETUPLOG$ from Value $TIME$ Product code: $PRODUCTCODE$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Revision code: $REVISIONCODE$ (at end of file)
Write into Text File $SETUPLOG$ from Value  (at end of file)
if Variable NATIVE_ENGINE Equals TRUE
  Write into Text File $SETUPLOG$ from Value $TIME$ Installer mode: Native Engine (at end of file)
else
  Write into Text File $SETUPLOG$ from Value $TIME$ Installer mode: MSI Engine (at end of file)
end
Write into Text File $SETUPLOG$ from Value  (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ OS: Windows $OPSYS$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Product Name:  $OSPRODUCTNAME$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Edition:  $OSEDITIONID$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Version:  $OSCURRENTVERSION$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Build:  $OSCURRENTBUILD$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Build Label:  $OSBUILDLABEL$ (at end of file)
if Variable WIN64MODE Equals TRUE
  Write into Text File $SETUPLOG$ from Value $TIME$ Architecture: 64bit (at end of file)
else
  Write into Text File $SETUPLOG$ from Value $TIME$ Architecture: 32bit (at end of file)
end
 
Comment: Read in the Platform major, minor and service pack numbers from the master file
Read from Text File $SUPPORTDIR$\MasterPlatformVersion.txt into Variable PLATFORMVERSIONMAJOR
Read from Text File $SUPPORTDIR$\MasterPlatformVersion.txt into Variable PLATFORMVERSIONMINOR
Read from Text File $SUPPORTDIR$\MasterPlatformVersion.txt into Variable PLATFORMVERSIONSPNUMBER
 
Write into Text File $SETUPLOG$ from Value  (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Install method: $INSTALLMETHOD$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Command line: $CMDLINE$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Win64Mode: $WIN64MODE$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Setup Path: $SETUPPATH$  (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Support Directory: $SUPPORTDIR$  (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Temporary Directory: $TEMPDIR$  (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ FrameworkRoot: $FRAMEWORKROOT$  (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ RegAsm32: $REGASM32$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ RegAsm64: $REGASM64$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ NGen32: $NGEN32$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ NGen64: $NGEN64$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ ProgramFiles: $PROGRAMFILES$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ CommonFiles: $COMMONFILES$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Maintenance: $MAINTENANCE$, RecommendedUpgrade: $RECOMMENDEDUPGRADE$, NeedsUpgrade: $NEEDSUPGRADE$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ GAC Assembly Reference Path: $GACREF$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ ShortcutFiles: $SHORTCUTFILES$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ ShortcutFilesAll: $SHORTCUTFILESALL$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ DesktopDir: $DESKTOPDIR$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ DesktopDirAll: $DESKTOPDIRALL$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ ASCOMStartMenu: $ASCOMSTARTMENU$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ AllUsers: $ALLUSERS$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Target Directory: $TARGETDIR$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Documents Directory: $MYDOCUMENTS$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Install cache directory: $INSTALLCACHEDIRECTORY$ (at end of file)
Write into Text File $SETUPLOG$ from Value  (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Platform Version: $PLATFORMVERSIONMAJOR$.$PLATFORMVERSIONMINOR$.$PLATFORMVERSIONSPNUMBER$ (at end of file)
Write into Text File $SETUPLOG$ from Value  (at end of file)
[END REGION]
 
[DEFINE REGION: Check Application Requirements]
Get System Setting Administrator Rights into CHECKSYSTEM
if Variable CHECKSYSTEM not Equals TRUE
  MessageBox: $TITLE$ Setup Error, This product requires at least Administrator Privileges.$NEWLINE$$NEWLINE$Setup cannot continue.
  Terminate Installation
end
 
Comment: .NET Framework 4.8 - Check that SP1 is installed if we are running on Windows 7
Get Exact OS Level into CHECKSYSTEM
if Variable CHECKSYSTEM Equals SEVEN
  Comment: We are running on Windows 7 so test for service pack 1
  Get Exact SP Level into CHECKSYSTEM
  if Variable CHECKSYSTEM not Greater Than 0
    Comment: We are running on Windows 7 without service pack 1 so cannot proceed because Framework 4.8 is only supported on Win 7 SP1
    Write into Text File $SETUPLOG$ from Value $TIME$ Found Windows 7 without SP1, terminating installation (at end of file)
    MessageBox: $TITLE$ Setup Issue, The ASCOM Platform requires .NET 4.8, which is only available on Windows 7.1 SP1, Windows 8.1, Windows 10 Anniversary Edition (1607) and later.$NEWLINE$$NEWLINE$Please install Windows 7 Service Pack 1 if you wish to install $TITLE$.$NEWLINE$$NEWLINE$The installer cannot continue and will now close.
    Terminate Installation
  end
end
 
Comment: .NET Framework 4.8 - Check that we are on 8.1 if we are running Windows 8
Get Exact OS Level into CHECKSYSTEM
if Variable CHECKSYSTEM Equals METRO
  Comment: We are running on Windows 8.0 so cannot proceed because Framework 4.8 is only supported on Win 8.1
  Write into Text File $SETUPLOG$ from Value $TIME$ Found Windows 8.0, terminating installation (at end of file)
  MessageBox: $TITLE$ Setup Issue, The ASCOM Platform requires .NET 4.8, which is only available on Windows 7.1 SP1, Windows 8.1, Windows 10 Anniversary Edition (1607) and later.$NEWLINE$$NEWLINE$Please update to Windows 8 if you wish to install $TITLE$.$NEWLINE$$NEWLINE$The installer cannot continue and will now close.
  Terminate Installation
end
 
Comment: .NET Framework 4.8 - Check that we are on at least Restone (Anniversary Update) if we are running Windows 10
Get System Setting Windows 10 into CHECKSYSTEM
if Variable CHECKSYSTEM Equals TRUE
  Comment: We are running on Windows 10 so make sure that we are at least on Redstone
  Get System Setting Windows 10 Redstone into CHECKSYSTEM
  if Variable CHECKSYSTEM not Equals TRUE
    Comment: We are running on Windows 10 with a Threshold version so cannot proceed because Framework 4.8 is only supported on Win 8.1
    Write into Text File $SETUPLOG$ from Value $TIME$ Found Windows 10 Threshold, terminating installation (at end of file)
    MessageBox: $TITLE$ Setup issue, The ASCOM Platform requires .NET 4.8, which is only available on Windows 7.1 SP1, Windows 8.1, Windows 10 Anniversary Edition (1607) and later.$NEWLINE$$NEWLINE$Please update to Windows 10 Anniversary Edition (version 1607) or later if you wish to install $TITLE$.$NEWLINE$$NEWLINE$The installer cannot continue and will now close.
    Terminate Installation
  end
end
 
Comment: Check that we are not below Windows 7 i.e. on XP
Get System Setting Windows 7 into CHECKSYSTEM
if Variable CHECKSYSTEM not Equals TRUE
  Write into Text File $SETUPLOG$ from Value $TIME$ Found Windows earlier than 7, terminating installation (at end of file)
  MessageBox: $TITLE$ Setup Issue, The ASCOM Platform requires .NET 4.8, which is only available on Windows 7.1 SP1, Windows 8.1, Windows 10 Anniversary Edition (1607) and later.$NEWLINE$$NEWLINE$Please update to a supported Windows version if you wish to install $TITLE$.$NEWLINE$$NEWLINE$The installer cannot continue and will now close.
  Terminate Installation
end
 
[END REGION]
 
[DEFINE REGION: Check Application Pre-Requisites]
Comment: Check setup pre-requisites
Set Variable PREREQ to FALSE
Set Variable PRELIST to 
Set Variable INSTALLED_MICROSOFT.NETFRAMEWORK4.8(X86ANDX64) to 
Include Script: checkmsi31
Include Script: checknet351
Include Script: checknet4.8_x86 
Comment: Include Script: check_vcruntime_x86
Comment: Include Script: check_vcruntime_x64
Write into Text File $SETUPLOG$ from Value  (at end of file)
 
Comment: Install setup pre-requisites
if Variable PREREQ not Equals FALSE
  if Variable INSTALLED_MICROSOFT.NETFRAMEWORK4.8(X86ANDX64) Equals FALSE
    Comment: If Framework 4 is missing then we don't need a message about 3.5 as well!
    Set Variable NET351 to TRUE
  end
  Display Dialog: prereq, wait for dialog to return (modal)
  if Variable WIZARD Equals CANCEL
    Comment: Cancel the install at user request.
    Terminate Installation
  else
    Comment: Check whether the user enabled .NET 3.5 SP1 while the pre-requisites dialogue was open. If still missing then terminate the install
    Include Script: checknet351
    if Variable NET351 Equals FALSE
      Set Variable INSTALLNET35 to FALSE
      Comment: Determine whether we are running on Windows 10 or later using value in System Settings..
      Get System Setting Windows 10 into WIN10ORLATER
      if Variable WIN10ORLATER Equals TRUE
        Comment: Running on Windows 10 or later so enable .NET 3.5 installation.
        Set Variable INSTALLNET35 to TRUE
        Write into Text File $SETUPLOG$ from Value $TIME$ Found Windows 10 or later through System Settings command: $INSTALLNET35$ (at end of file)
      else
        Comment: Further attempt to determine whether we are running on Windows 10 or later using the OS build number.
        Comment: Test for versions after Windows 10 Threshold 2 i.e. Redstone 1 and later.
        if Variable OSCURRENTBUILD Greater Than 10586
          Comment: Running on Windows 10 or later so enable .NET 3.5 installation.
          Set Variable INSTALLNET35 to TRUE
          Write into Text File $SETUPLOG$ from Value $TIME$ Found Windows 10 or later through OS Build number: $INSTALLNET35$ (at end of file)
        end
      end
      if Variable INSTALLNET35 Equals TRUE
        Write into Text File $SETUPLOG$ from Value $TIME$ Installing .NET 3.5 automatically using DISM. (at end of file)
        Run Program $SUPPORTDIR$\EnableDotNet35.cmd  (WAIT, get result into variable RC)
        Write into Text File $SETUPLOG$ from Value $TIME$ Completed DISM execution. Return code: $RC$. (at end of file)
        Write into Text File $SETUPLOG$ from Value  (at end of file)
        if Variable RC not Equals 0
          Comment: DISM returned a non-zero exit code.
          if Variable RC Equals 3010
            Comment: DISM requires a reboot
            Write into Text File $SETUPLOG$ from Value $TIME$ Completed - DISM requires a reboot. Return code: $RC$. (at end of file)
            MessageBox: Pre-requisites, .NET 3.5 installation is complete but your PC must be rebooted in order to take effect.$NEWLINE$$NEWLINE$The Platform installer will now close.$NEWLINE$$NEWLINE$Please reboot your PC and re-run the Platform installer.
            Terminate Installation
          else
            Comment: Something went wrong during installation of .NET 3.5.
            Write into Text File $SETUPLOG$ from Value $TIME$ Completed - DISM failed and returned error code: $RC$. (at end of file)
            MessageBox: Pre-requisites, The .NET 3.5 installation process ran but returned error code $RC$.$NEWLINE$$NEWLINE$Please address the issue reported by DISM and then re-run the Platform installer.$NEWLINE$$NEWLINE$The Platform installer will now close.
            Terminate Installation
          end
        end
      else
        Comment: Running on Windows 7 or 8 so provide instructions on how to install .NET 3.5
        Write into Text File $SETUPLOG$ from Value $TIME$ Windows $OPSYS - .NET 3.5 must be enabled manually. (at end of file)
        MessageBox: Pre-requisites, The Platform cannot install .NET 3.5 becasue you are running an OS earlier than Windows 10.$NEWLINE$$NEWLINE$Please install it manually through Control Panel / Programs / Programs and Features / Turn Windows features on or off.$NEWLINE$$NEWLINE$The Platform installer will now close.
        Terminate Installation
      end
    end
  end
end
[END REGION]
 
[DEFINE REGION: Main Setup Dialogue]
if Variable MAINTENANCE Equals TRUE
  Write into Text File $SETUPLOG$ from Value $TIME$ Mode: Maintenance (at end of file)
  GoTo Label: Maintenance
else
  Comment: First Time Install
  Write into Text File $SETUPLOG$ from Value $TIME$ Mode: Install new version (at end of file)
end
 
label: Welcome Dialog
Show Component: ASCOM Platform Options\Display user guide when installation is complete
Display Dialog: welcome, wait for dialog to return (modal)
Comment: Exit Setup when install is cancelled
if Variable WIZARD Equals CANCEL
  Write into Text File $SETUPLOG$ from Value $TIME$ Installation cancelled at user request (Main welcome) (at end of file)
  Terminate Installation
end
if Variable WIZARD Equals README
  Write into Text File $SETUPLOG$ from Value $TIME$ ReadMe shown (at end of file)
  GoTo Label: ReadMe Information
end
GoTo Label: Main Install
 
label: ReadMe Information
Display Dialog: readme, wait for dialog to return (modal)
Comment: Exit Setup if install is cancelled
if Variable WIZARD Equals CANCEL
  Write into Text File $SETUPLOG$ from Value $TIME$ Installation cancelled at user request (ReadMe) (at end of file)
  Terminate Installation
end
Comment: Return to the welcome screen to continue
GoTo Label: Welcome Dialog
[END REGION]
 
[DEFINE REGION: Maintenance Dialogue]
label: Maintenance
Comment: Display maintenance dialogue
Display Dialog: maintenance, wait for dialog to return (modal)
Comment: Exit Setup if cancelled
if Variable WIZARD Equals (Ignore Case) CANCEL
  Write into Text File $SETUPLOG$ from Value $TIME$ Maintenance cancelled at user request (Maintenance) (at end of file)
  Terminate Installation
end
Write into Text File $SETUPLOG$ from Value $TIME$ Maintenance user choice - Modify: $MODIFY$ ,Repair: $REPAIR$, Remove: $REMOVE$ (at end of file)
 
if Variable REPAIR Equals (Ignore Case) TRUE
  Set Variable PROGRESSTEXT to Repairing Platform 6...
end
 
if Variable MODIFY Equals (Ignore Case) TRUE
  Hide Component: ASCOM Platform Options\Display user guide when installation is complete
  Display Dialog: welcome, wait for dialog to return (modal)
  Comment: Exit Setup when install is cancelled
  if Variable WIZARD Equals CANCEL
    Write into Text File $SETUPLOG$ from Value $TIME$ Installation cancelled at user request (Modify) (at end of file)
    Terminate Installation
  end
  Set Variable PROGRESSTEXT to Maintaining Platform 6...
end
 
if Variable REMOVE Equals (Ignore Case) TRUE
  Set Variable ABORT to FALSE
  Display Dialog: ConfirmRemove, wait for dialog to return (modal)
  if Variable ABORT Equals (Ignore Case) TRUE
    Write into Text File $SETUPLOG$ from Value $TIME$ Maintenance - Modify: $MODIFY$ ,Repair: $REPAIR$, Remove: $REMOVE$ - Uninstall cancelled (at end of file)
    Terminate Installation
  end
  Set Variable PROGRESSTEXT to Removing Platform 6...
end
Write into Text File $SETUPLOG$ from Value $TIME$ Maintenance after processing - Modify: $MODIFY$ ,Repair: $REPAIR$, Remove: $REMOVE$ (at end of file)
[END REGION]
 
[DEFINE REGION: Prepare for Installation or Uninstallation]
label: Main Install
 
Comment: Get the state of the installable components
Get Component ASCOM Platform Options Selection State into Variable INSTALL_PLATFORM
Get Component ASCOM Platform Options\Install Diagnostics shortcut on desktop Selection State into Variable INSTALL_DIAGNOSTICS_SHORTCUT_ON_DESKTOP
Get Component ASCOM Platform Options\Install Profile Explorer shortcut on desktop Selection State into Variable INSTALL_PROFILE_EXPLORER_SHORTCUT_ON_DESKTOP
Get Component ASCOM Platform Options\Display user guide when installation is complete Selection State into Variable DISPLAY_USER_GUIDE
Get Component Out of date hubs replaced by Device Hub\POTH Selection State into Variable INSTALL_POTH
Get Component Out of date hubs replaced by Device Hub\Dome Control Hub Selection State into Variable INSTALL_DOMECONTROLHUB
Get Component Out of date hubs replaced by Device Hub\Pipe Selection State into Variable INSTALL_PIPE
Get Component Out of date hubs replaced by Device Hub\Hub Selection State into Variable INSTALL_HUB
Write into Text File $SETUPLOG$ from Value $TIME$ Platform Installation Options - $INSTALL_PLATFORM$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Install Desktop Diagnostics Shortcut - $INSTALL_DIAGNOSTICS_SHORTCUT_ON_DESKTOP$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Install Profile Explorer Shortcut - $INSTALL_PROFILE_EXPLORER_SHORTCUT_ON_DESKTOP$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Display User Guide - $DISPLAY_USER_GUIDE$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Install POTH - $INSTALL_POTH$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Install Dome Control Hub - $INSTALL_DOMECONTROLHUB$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Install Pipe - $INSTALL_PIPE$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Install Hub - $INSTALL_HUB$ (at end of file)
Write into Text File $SETUPLOG$ from Value   (at end of file)
 
Comment: Prepare to install
Display Dialog: progress, use as progress dialog (non-modal)
[END REGION]
 
[DEFINE REGION: Install Visual C Runtimes]
Comment: Install pre-requisites included in this installer
Include Script: setupmsi31
Set Variable MYPROGRESS to 3
Comment: Include Script: setup_vcruntime_x64 (get result into variable VC64_REBOOT_REQUIRED)
Set Variable MYPROGRESS to 6
Comment: Include Script: setup_vcruntime_x86 (get result into variable VC32_REBOOT_REQUIRED)
Set Variable MYPROGRESS to 9
Write into Text File $SETUPLOG$ from Value  (at end of file)
[END REGION]
 
[DEFINE REGION: Remove Previous Platform 6 install if present]
Comment: Ensure that we remove previous Platform 6 versions built using either MSI or Native install
Set Variable REQUIRESUPGRADE to FALSE
Comment: Native install requires upgrade
if Variable RECOMMENDEDUPGRADE Equals TRUE
  Set Variable REQUIRESUPGRADE to TRUE
end
Comment: MSI install requires upgrade
if Variable NEEDSUPGRADE Equals TRUE
  Set Variable REQUIRESUPGRADE to TRUE
end
 
if Variable REQUIRESUPGRADE Equals TRUE
  Set Variable PROGRESSTEXT to Uninstalling current Platform...
   
  Comment: Save the Windows error reporting UI current state and turn eror reproting UI off
  Read Registry Key HKLM\SOFTWARE\Microsoft\Windows\Windows Error Reporting\DontShowUI into WINERRORUISTATE
  Write into Text File $SETUPLOG$ from Value $TIME$ Windows error reporting UI state - $WINERRORUISTATE$ (at end of file)
  Run Program $SUPPORTDIR$\SuppressWinErrors.exe True (WAIT, get result into variable RC)
  Read Registry Key HKLM\SOFTWARE\Microsoft\Windows\Windows Error Reporting\DontShowUI into WINERRORUISTATENEW
  Write into Text File $SETUPLOG$ from Value $TIME$ New Windows error reporting UI state - $WINERRORUISTATENEW$ (at end of file)
   
  Comment: Report location of our uninstaller
  Read Registry Key HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$PRODUCTCODE$\UninstallString into UNINSTALLER
  Set Variable MYPROGRESS to 10
  Write into Text File $SETUPLOG$ from Value $TIME$ Uninstalling old Platform 6 - $UNINSTALLER$ (at end of file)
   
  Comment: Run uninstaller
  Run Program $UNINSTALLER$ /s MODIFY=FALSE REMOVE=TRUE UNINSTALL=YES (WAIT, get result into variable UNINSTALLCODE)
   
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $UNINSTALLCODE$ - Completed uninstallation (at end of file)
  Set Variable MYPROGRESS to 19
   
  Comment: Now process the installer error code
  if Variable UNINSTALLCODE not Equals 0
    MessageBox: Unable to uninstall current Platform, The installer can't uninstall your current Platform. $NEWLINE$$NEWLINE$Please click the "Yes" button to clean up your system or click the "No" button to terminate this installer.$NEWLINE$$NEWLINE$Eror code: $UNINSTALLCODE$
    if Variable ERROROLD Equals YES
      Write into Text File $SETUPLOG$ from Value $TIME$ ForcePlatform: User selected YES (at end of file)
      Comment: User selected YES so run the ForceRemove program
      Run Program $SUPPORTDIR$\RemoveAscom.exe  (WAIT, get result into variable ERROROLD)
      Write into Text File $SETUPLOG$ from Value $TIME$ RC: $ERROROLD$ - RemoveASCOM (at end of file)
       
      if Variable ERROROLD Equals 99
        Comment: User ran ForceRemove but chose NOT to remove the Platform so give them a message and terminate the installer
        Write into Text File $SETUPLOG$ from Value $TIME$ Terminating install. (at end of file)
        MessageBox: Unable to uninstall current Platform, You chose not to force Platform removal so this installer cannot continue and will now close when you click "OK".
        Set Variable TERMINATEINSTALL to TRUE
      else
        Comment: We've just forcibly removed the Platform and Profile store so now we must pretend that we are a first time install
        Set Variable REQUIRESUPGRADE to FALSE
        Write into Text File $SETUPLOG$ from Value $TIME$ Platform uninstaller run completed, (at end of file)
      end
    else
      Comment: User selected No so just terminate the installer.
      Write into Text File $SETUPLOG$ from Value $TIME$ ForcePlatform: User selected NO - Terminating install. (at end of file)
      Set Variable TERMINATEINSTALL to TRUE
    end
  end
   
  Comment: Return the original state of WINERRORUISTATE
  if Variable WINERRORUISTATE Equals 
    Set Variable WINERRORUISTATE to Remove
  end
  Run Program $SUPPORTDIR$\SuppressWinErrors.exe $WINERRORUISTATE$ (WAIT, get result into variable RC)
  Read Registry Key HKLM\SOFTWARE\Microsoft\Windows\Windows Error Reporting\DontShowUI into WINERRORUISTATENEW
  Write into Text File $SETUPLOG$ from Value $TIME$ Final Windows error reporting UI state - $WINERRORUISTATENEW$ (at end of file)
   
  Comment: Terminate if required because of problems uninstalling a previous application
  if Variable TERMINATEINSTALL Equals TRUE
    Terminate Installation
  end
  Set Variable MAINTENANCE to FALSE
  Set Variable MYPROGRESS to 20
end
[END REGION]
 
[DEFINE REGION: Remove Previous Platforms 4 and 5 if present]
Comment: Remove Platform 5 and 5.5 if we are in initial install mode and not Maintenance or Upgrade modes
if Variable MAINTENANCE not Equals TRUE
  Comment: Only try and remove Platforms 4 and  5 if we are not upgrading a previous Platform 6 install
  if Variable REQUIRESUPGRADE Equals FALSE
    Write into Text File $SETUPLOG$ from Value $TIME$ Straight forward install - removing old Platform 4 or 5 if it exists (at end of file)
    Comment: Check for Platform 4.1
    Set Variable UNINSTALLER41 to 
    Set Variable PLATFORM4FOUND to FALSE
    Comment: Check for Platform 4.1
    Read Registry Key HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\ASCOM Platform 4.1\UninstallString into UNINSTALLER41
    if Variable UNINSTALLER41 not Equals 
      Set Variable PLATFORM4FOUND to TRUE
    end
    Write into Text File $SETUPLOG$ from Value $TIME$ Platform 4.1 - $UNINSTALLER41$ (at end of file)
    Comment: Check whether Platform 5 is actually installed, only try and uninstall if present! Test is presence of Platform 5 Uninstall string in registry
    Set Variable UNINSTALLER5A to 
    Set Variable PLATFORM5FOUND to FALSE
    Comment: Check for Platform 5a
    Read Registry Key HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{075F543B-97C5-4118-9D54-93910DE03FE9}\UninstallString into UNINSTALLER5A
    if Variable UNINSTALLER5A not Equals 
      Set Variable PLATFORM5FOUND to TRUE
    end
    Write into Text File $SETUPLOG$ from Value $TIME$ Platform 5A - $UNINSTALLER5A$ (at end of file)
    Comment: Check for Platform 5b
    Set Variable UNINSTALLER5B to 
    Read Registry Key HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\{14C10725-0018-4534-AE5E-547C08B737B7}\UninstallString into UNINSTALLER5B
    if Variable UNINSTALLER5B not Equals 
      Set Variable PLATFORM5FOUND to TRUE
    end
    Write into Text File $SETUPLOG$ from Value $TIME$ Platform 5B - $UNINSTALLER5B$ (at end of file)
    Comment: Run the uninstaller if either platform is found
    Set Variable RC to 0
    if Variable PLATFORM5FOUND Equals TRUE
      Set Variable PROGRESSTEXT to Removing Platform 5...
      Write into Text File $SETUPLOG$ from Value $TIME$ Uninstalling Platform 5... (at end of file)
      Run Program $SUPPORTDIR$\UninstallAscom.exe  (WAIT, get result into variable RC)
      Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ UninstallASCOM  (at end of file)
      Set Variable PROGRESSTEXT to Installing Platform 6...
    else
      if Variable PLATFORM4FOUND Equals TRUE
        Set Variable PROGRESSTEXT to Removing Platform 4...
        Write into Text File $SETUPLOG$ from Value $TIME$ Uninstalling Platform 4... (at end of file)
        Run Program $SUPPORTDIR$\UninstallAscom.exe  (WAIT, get result into variable RC)
        Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ UninstallASCOM  (at end of file)
        Set Variable PROGRESSTEXT to Installing Platform 6...
      end
    end
    if Variable RC not Equals 0
      MessageBox: Profile Migration, Unable to set write access to the ASCOM Profile store. Please zip up all logs in your Documents\ASCOM folder and its subfolders  and attach the zip to a post on the ASCOM-Talk Groups.Io forum.
      Set Variable ASCOMERROR to Profile migration issue. RC: $RC$
    end
  end
end
[END REGION]
 
[DEFINE REGION: Uninstall items installed by this installer]
 
if Variable REMOVE Equals TRUE
   
  [DEFINE REGION: Remove 64bit components]
   
  Comment: Remove 64bit native images and 64bit component COM registration if necessary
  if Variable WIN64MODE Equals TRUE
    Set x64 - Native 64 bit Windows, AMD64, EM64T, and ARM64 Architectures - installation mode
    Comment: Remove 64bit native images
    Set Variable MYPROGRESS to 40
    Set Variable PROGRESSTEXT to Removing 64bit native images - ASCOM.Utilities.Video - v6.1.0.0
    Run Program $NGEN64$ uninstall "ASCOM.Utilities.Video, Version=6.1.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Uninstall - ASCOM.Utilities.Video 6.1.0.0 (at end of file)
    Set Variable PROGRESSTEXT to Removing 64bit native images - ASCOM.DriverAccess - v6.0.0.0
    Run Program $NGEN64$ uninstall "ASCOM.DriverAccess, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Uninstall - ASCOM.DriverAccess 6.0.0.0 (at end of file)
    Set Variable PROGRESSTEXT to Removing 64bit native images - ASCOM.Astrometry - v5.5.6.0
    Run Program $NGEN64$ uninstall "ASCOM.Astrometry, Version=5.5.6.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Uninstall - Astrometry 5.5.6.0 (at end of file)
    Set Variable PROGRESSTEXT to Removing 64bit native images - ASCOM.Astrometry - v6.0.0.0
    Run Program $NGEN64$ uninstall "ASCOM.Astrometry, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Uninstall - Astrometry 6.0.0.0 (at end of file)
    Set Variable MYPROGRESS to 45
    Set Variable PROGRESSTEXT to Removing 64bit native images - ASCOM.Utilities - v6.0.0.0
    Run Program $NGEN64$ uninstall "ASCOM.Utilities, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Uninstall - ASCOM.Utilities 6.0.0.0 (at end of file)
    Set Variable PROGRESSTEXT to Removing 64bit native images - ASCOM.DeviceInterfaces - v6.0.0.0
    Run Program $NGEN64$ uninstall "ASCOM.DeviceInterfaces, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Uninstall - ASCOM.DeviceInterfaces 6.0.0.0 (at end of file)
    Set Variable PROGRESSTEXT to Removing 64bit native images - ASCOM.Exceptions- v 6.0.0.0
    Run Program $NGEN64$ uninstall "ASCOM.Exceptions, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Uninstall - ASCOM.Exceptions 6.0.0.0 (at end of file)
    Set Variable PROGRESSTEXT to Removing 64bit native images - ASCOM.Cache - v6.0.0.0
    Run Program $NGEN64$ uninstall "ASCOM.Cache, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Uninstall - ASCOM.Cache 6.0.0.0 (at end of file)
    Set Variable MYPROGRESS to 50
     
    Comment: Unregister 64bit components
    Set Variable PROGRESSTEXT to Unregistering 64bit COM component - ASCOM.Astrometry - v6.0.0.0
    Run Program $REGASM64$ /unregister "$COMMONFILES$\ASCOM\Platform\v6\ASCOM.Astrometry.dll" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm ASCOM.Unregister ASCOM.Astrometry 6.0.0.0 (at end of file)
    Set Variable PROGRESSTEXT to Unregistering 64bit COM component - ASCOM.Exceptions - v6.0.0.0
    Run Program $REGASM64$ /unregister "$COMMONFILES$\ASCOM\Platform\v6\ASCOM.Exceptions.dll" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm Unregister ASCOM.Exceptions 6.0.0.0 (at end of file)
    Set Variable PROGRESSTEXT to Unregistering 64bit COM component - ASCOM.Utilities - v6.0.0.0
    Run Program $REGASM64$ /unregister "$COMMONFILES$\ASCOM\Platform\v6\ASCOM.Utilities.dll" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm Unregister ASCOM.Utilities 6.0.0.0 (at end of file)
    Set Variable PROGRESSTEXT to Unregistering 64bit COM component - ASCOM.Utilities.Video - v6.1.0.0
    Run Program $REGASM64$ /unregister "$COMMONFILES$\ASCOM\Platform\v6.1\ASCOM.Utilities.Video.dll" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm Unregister ASCOM.Utilities.Video 6.1.0.0 (at end of file)
    Set Variable PROGRESSTEXT to Unregistering 64bit COM component - ASCOM.Cache - v6.0.0.0
    Run Program $REGASM64$ /unregister "$COMMONFILES$\ASCOM\Platform\v6.4\ASCOM.Cache.dll" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm Unregister ASCOM.Cache 6.0.0.0 (at end of file)
     
    Comment: Clean up any remaining 64bit COM registry entries
    Set Variable PROGRESSTEXT to Cleaning 64bit simulator COM entries
    Write into Text File $SETUPLOG$ from Value $TIME$ Cleaning simulator 64bit COM entries (at end of file)
    Include Script: CleanRegistry
     
    Set Win32 - Native 32 bit Windows and Windows 32 on Windows 64 (WOW64) - installation mode
  end
   
  [END REGION]
   
  [DEFINE REGION: Remove 32bit components]
  Comment: Remove 32bit components
  Set Variable MYPROGRESS to 55
  Set Variable PROGRESSTEXT to Removing 32bit native images - ASCOM.DeviceInterfaces - v6.0.0.0
  Run Program $NGEN32$ uninstall "ASCOM.DeviceInterfaces, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Uninstall - ASCOM.DeviceInterfaces 6.0.0.0 (at end of file)
  Set Variable PROGRESSTEXT to Removing 32bit native images - ASCOM.Helper - v1.0.0.0
  Run Program $NGEN32$ uninstall "ASCOM.Helper, Version=1.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Uninstall - ASCOM Helper 1.0.0.0 (at end of file)
  Set Variable MYPROGRESS to 60
  Set Variable PROGRESSTEXT to Removing 32bit native images - ASCOM.Utilities - v6.0.0.0
  Run Program $NGEN32$ uninstall "ASCOM.Utilities, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Uninstall - ASCOM.Utilities 6.0.0.0 (at end of file)
  Set Variable PROGRESSTEXT to Removing 32bit native images - ASCOM.Utilities.Video - v6.1.0.0
  Run Program $NGEN32$ uninstall "ASCOM.Utilities.Video, Version=6.1.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Uninstall - VideoUtils 6.1 (at end of file)
  Set Variable MYPROGRESS to 65
  Set Variable PROGRESSTEXT to Removing 32bit native images - ASCOM.Astrometry - v5.5.6.0
  Run Program $NGEN32$ uninstall "ASCOM.Astrometry, Version=5.5.6.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Uninstall - ASCOM.Astrometry 5.5.6.0 (at end of file)
  Set Variable PROGRESSTEXT to Removing 32bit native images - ASCOM.Astrometry - v6.0.0.0
  Run Program $NGEN32$ uninstall "ASCOM.Astrometry, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Uninstall - ASCOM.Astrometry 6.0.0.0 (at end of file)
  Set Variable MYPROGRESS to 70
  Set Variable PROGRESSTEXT to Removing 32bit native images - ASCOM.DriverAccess - v6.0.0.0
  Run Program $NGEN32$ uninstall "ASCOM.DriverAccess, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Uninstall - ASCOM.DriverAccess 6.0.0.0 (at end of file)
  Set Variable MYPROGRESS to 75
  Set Variable PROGRESSTEXT to Removing 32bit native images - ASCOM.Helper2 - v1.0.0.0
  Run Program $NGEN32$ uninstall "ASCOM.Helper2, Version=1.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Uninstall - ASCOM.Helper2 1.0.0.0 (at end of file)
  Set Variable PROGRESSTEXT to Removing 32bit native images - ASCOM.Exceptions - v6.0.0.0
  Run Program $NGEN32$ uninstall "ASCOM.Exceptions, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Uninstall - ASCOM.Exceptions 6.0.0.0 (at end of file)
  Set Variable PROGRESSTEXT to Removing 32bit native images - DirectShowLib-2005 - v2.1.0.15637
  Run Program $NGEN32$ uninstall "DirectShowLib-2005, Version=2.1.0.15637, Culture=neutral, PublicKeyToken=67e7b740cdfc2d3f" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Uninstall - DirectShowLib 2.1.0.15637 (at end of file)
  Set Variable PROGRESSTEXT to Removing 32bit native images - ASCOM.Cache - v6.0.0.0
  Run Program $NGEN32$ uninstall "ASCOM.Cache, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Uninstall - ASCOM.Cache 6.0.0.0 (at end of file)
   
  Set Variable PROGRESSTEXT to Removing ASCOM.Exceptions 1.0 policy
  Run Program $COMMONFILES$\ASCOM\Platform\Internal\ASCOM.Internal.GACInstall.exe /u policy.1.0.ASCOM.Exceptions", startup in folder $COMMONFILES$\ASCOM\Platform\v6.0 (WAIT, get result into variable GACINSTALLRC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $GACINSTALLRC$ GACInstall Remove policy.1.0.ASCOM.Exceptions (at end of file)
  if Variable GACINSTALLRC not Equals 0
    MessageBalloon: GACInstall, Utilities install error RC: $GACINSTALLRC$ $COMMONFILES$\ASCOM\Platform\Internal\ASCOM.Internal.GACInstall.exe
  end
  Set Variable PROGRESSTEXT to Removing ASCOM.Exceptions 1.1 policy
  Run Program $COMMONFILES$\ASCOM\Platform\Internal\ASCOM.Internal.GACInstall.exe /u policy.1.1.ASCOM.Exceptions", startup in folder $COMMONFILES$\ASCOM\Platform\v6.0 (WAIT, get result into variable GACINSTALLRC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $GACINSTALLRC$ GACInstall Remove policy.1.1.ASCOM.Exceptions (at end of file)
  if Variable GACINSTALLRC not Equals 0
    MessageBalloon: GACInstall, Utilities install error RC: $GACINSTALLRC$ $COMMONFILES$\ASCOM\Platform\Internal\ASCOM.Internal.GACInstall.exe
  end
  Set Variable PROGRESSTEXT to Removing ASCOM.Utilities 5.5 policy
  Run Program $COMMONFILES$\ASCOM\Platform\Internal\ASCOM.Internal.GACInstall.exe /u policy.5.5.ASCOM.Utilities, startup in folder $COMMONFILES$\ASCOM\Platform\v5.5 (WAIT, get result into variable GACINSTALLRC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $GACINSTALLRC$ GACInstall Remove policy.5.5.ASCOM.Utiliites (at end of file)
  if Variable GACINSTALLRC not Equals 0
    MessageBalloon: GACInstall, Utilities install error RC: $GACINSTALLRC$ $COMMONFILES$\ASCOM\Platform\Internal\ASCOM.Internal.GACInstall.exe
  end
  Set Variable PROGRESSTEXT to Removing ASCOM.DriverAccess 1.0 policy
  Run Program $COMMONFILES$\ASCOM\Platform\Internal\ASCOM.Internal.GACInstall.exe /u policy.1.0.ASCOM.DriverAccess, startup in folder $COMMONFILES$\ASCOM\Platform\v5.5 (WAIT, get result into variable GACINSTALLRC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $GACINSTALLRC$ GACInstall Remove policy.1.0.DriverAccess (at end of file)
  if Variable GACINSTALLRC not Equals 0
    MessageBalloon: GACInstall, DriverAccess install error RC: $GACINSTALLRC$
  end
  Set Variable PROGRESSTEXT to Removing ASCOM.Astrometry 5.5 policy
  Run Program $COMMONFILES$\ASCOM\Platform\Internal\ASCOM.Internal.GACInstall.exe /u policy.5.5.ASCOM.Astrometry, startup in folder $COMMONFILES$\ASCOM\Platform\v5.5 (WAIT, get result into variable GACINSTALLRC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $GACINSTALLRC$ GACInstall Remove policy.5.5.Astrometry (at end of file)
  if Variable GACINSTALLRC not Equals 0
    MessageBalloon: GACInstall, DriverAccess install error RC: $GACINSTALLRC$
  end
   
  Comment: Unregister assemblies
  Set Variable MYPROGRESS to 80
  Set Variable PROGRESSTEXT to Unregistering ASCOM.Astrometry - v5.5.6.0
  Write into Text File $SETUPLOG$ from Value $TIME$ Unregistering Astrometry 5.5.6.0 (at end of file)
  Unregister assembly ASCOM.Astrometry, Version=5.5.6.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable PROGRESSTEXT to Unregistering ASCOM.Astrometry - v6.0.0.0
  Write into Text File $SETUPLOG$ from Value $TIME$ Unregistering Astrometry 6.0.0.0 (at end of file)
  Unregister assembly ASCOM.Astrometry, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable PROGRESSTEXT to Unregistering ASCOM.Exceptions - v1.1.0.0
  Write into Text File $SETUPLOG$ from Value $TIME$ Unregistering Exceptions 1.1.0.0 (at end of file)
  Unregister assembly ASCOM.Exceptions, Version=1.1.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable PROGRESSTEXT to Unregistering ASCOM.Exceptions- v6.0.0.0
  Write into Text File $SETUPLOG$ from Value $TIME$ Unregistering Exceptions 6.0.0.0 (at end of file)
  Unregister assembly ASCOM.Exceptions, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable MYPROGRESS to 85
  Set Variable PROGRESSTEXT to Unregistering ASCOM.Interfaces - v1.0.0.0
  Write into Text File $SETUPLOG$ from Value $TIME$ Unregistering Interfaces 1.0.0.0 (at end of file)
  Unregister assembly ASCOM.Interfaces, Version=1.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable PROGRESSTEXT to Unregistering ASCOM.Internal.FusionLib - v1.0.0.0
  Write into Text File $SETUPLOG$ from Value $TIME$ Unregistering FusionLib 1.0.0.0 (at end of file)
  Unregister assembly ASCOM.Internal.FusionLib, Version=1.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable PROGRESSTEXT to Unregistering ASCOM.Utilities - v5.5.6.0
  Write into Text File $SETUPLOG$ from Value $TIME$ Unregistering Utilities 5.5.6.0 (at end of file)
  Unregister assembly ASCOM.Utilities, Version=5.5.6.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable PROGRESSTEXT to Unregistering ASCOM.Utilities - v6.0.0.0
  Write into Text File $SETUPLOG$ from Value $TIME$ Unregistering Utilities 6.0.0.0 (at end of file)
  Unregister assembly ASCOM.Utilities, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable PROGRESSTEXT to Unregistering ASCOM.Cache - v6.0.0.0
  Write into Text File $SETUPLOG$ from Value $TIME$ Unregistering Cache 6.0.0.0 (at end of file)
  Unregister assembly ASCOM.Cache, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
   
  Comment: Unregister MasterInterfaces TypeLib
  Set Variable PROGRESSTEXT to Unregistering ASCOM Master Interfaces Typelib
  Write into Text File $SETUPLOG$ from Value $TIME$ Unregistering ASCOM Master Interfaces typelib (at end of file)
  Run Program $COMMONFILES$\ASCOM\Platform\internal\regtlb.exe -u "$COMMONFILES$\ASCOM\Interface\AscomMasterInterfaces.tlb" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Unregistered ASCOM Master Interfaces typelib (at end of file)
   
  Comment: Clean up any remaining 32bit COM registry entries
  Set Variable PROGRESSTEXT to Cleaning 32bit simulator COM entries
  Write into Text File $SETUPLOG$ from Value $TIME$ Cleaning simulator 32bit COM entries (at end of file)
  Include Script: CleanRegistry
   
  Set Variable MYPROGRESS to 90
  [END REGION]
   
  Set Variable PROGRESSTEXT to Uninstalling Platform...
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Uninstalling Platform 6 (at end of file)
  Apply Uninstall (get result into variable SUCCESS)
  Write into Text File $SETUPLOG$ from Value $TIME$ Uninstall return code: $SUCCESS$ (at end of file)
  if Variable SUCCESS not Equals ERROR
    if Variable SUCCESS not Equals CANCEL
      Set Variable PROGRESSTEXT to Removing pinned assemblies
      Write into Text File $SETUPLOG$ from Value $TIME$ Removing unpinned assemblies (at end of file)
      Remove Unpinned Assemblies
      Write into Text File $SETUPLOG$ from Value $TIME$ Removed unpinned assemblies (at end of file)
    end
  end
   
  Set Variable MYPROGRESS to 100
  MessageBalloon: , 
  Set Variable PROGRESSTEXT to Finished uninstalling Platform 6
  Write into Text File $SETUPLOG$ from Value $TIME$ Finished uninstalling Platform 6 (at end of file)
   
  Comment: Bypass the installation code and go to the finish dialogue
  GoTo Label: Finish Setup
end
 
[END REGION]
 
[DEFINE REGION: Install Application Pre-Requisites if required]
Comment: Ensure that the corrrect Profile registry ACL is set on every run to repair broken installations
Set Variable PROGRESSTEXT to Preparing ASCOM Profile Store...
Write into Text File $SETUPLOG$ from Value $TIME$ Setting Profile registry ACL (at end of file)
Run Program $SUPPORTDIR$\UninstallAscom.exe /SETPROFILEACL (WAIT, get result into variable RC)
Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Set ACL on ASCOM Profile Store (at end of file)
 
Comment: Test whether an error occured when setting the Profile ACL and report this if necessary
if Variable RC not Equals 0
  MessageBox: Set ASCOM Profile Permissions, An error has occured when setting the ASCOM Profile ACL, please zip up all logs in your Documents\ASCOM folder and its sub-folders and report this on the ASCOM-Talk Groups.Io forum.$NEWLINE$$NEWLINE$Error code: $RC$
  if Variable ASCOMERROR not Equals 
    Set Variable ASCOMERROR to $ASCOMERROR$$NEWLINE$
  end
  Set Variable ASCOMERROR to $ASCOMERROR$Error setting ASCOM Profile ACL. RC: $RC$
end
[END REGION]
 
[DEFINE REGION: Install New Platform 6 version]
 
[DEFINE REGION: Clean up any remaining simulator COM entries]
Comment: Clean up any remaining 32bit COM registry entries
Set Variable PROGRESSTEXT to Cleaning simulator COM entries
Write into Text File $SETUPLOG$ from Value $TIME$ Cleaning simulator 32bit COM entries (at end of file)
Include Script: CleanRegistry
 
Comment: Clean up any remaining 64bit COM registry entries
if Variable WIN64MODE Equals TRUE
  Set x64 - Native 64 bit Windows, AMD64, EM64T, and ARM64 Architectures - installation mode
  Write into Text File $SETUPLOG$ from Value $TIME$ Cleaning simulator 64bit COM entries (at end of file)
  Include Script: CleanRegistry
  Set Win32 - Native 32 bit Windows and Windows 32 on Windows 64 (WOW64) - installation mode
end
[END REGION]
 
Comment: ***** Start of Platform Installation *****
Set Variable PROGRESSTEXT to Installing $TITLE$
Write into Text File $SETUPLOG$ from Value   (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ Start of Platform installation (at end of file)
 
Comment: Create the main ASCOM folder in Common Files
Create Folder $COMMONFILES$\ASCOM
 
[DEFINE REGION: Platform 5 files]
Comment: Type libraries
Install Files ..\..\..\..\Interfaces\Master Interfaces\AscomMasterInterfaces.tlb to $COMMONFILES$\ASCOM\Interface
Install Files ..\..\..\..\Interfaces\HelperPIAs\Helper.tlb to $COMMONFILES$\ASCOM\Interface
Install Files ..\..\..\..\Interfaces\HelperPIAs\Helper2.tlb to $COMMONFILES$\ASCOM\Interface
Install Files ..\..\..\..\Interfaces\IObjectSafety.tlb to $COMMONFILES$\ASCOM\Interface
Comment: Type library installer
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\RegTlb.exe to $COMMONFILES$\ASCOM\Platform\Internal
Comment: Redistributable support files
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\mscomctl.OCX to $WINSYSDIR$ (Never Overwrite)
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\MSComm32.Ocx to $WINSYSDIR$ (Never Overwrite)
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\msvbvm60.dll to $WINSYSDIR$ (Never Overwrite)
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\comdlg32.ocx to $WINSYSDIR$ (Never Overwrite)
Comment: Platform 5 assemblies
Comment: ASCOM.DriverAccess 1.0.5 is not copied because it is replaced with 1.0.6 in Platform 6
Install Files ..\..\..\..\ASCOM.DriverAccess.Platform5\Publisher Policy 1.0.6\policy.1.0.ASCOM.DriverAccess.dll to $COMMONFILES$\ASCOM\Platform\v5.5
Install Files ..\..\..\..\ASCOM.DriverAccess.Platform5\Publisher Policy 1.0.6\DriverAccess.config to $COMMONFILES$\ASCOM\Platform\v5.5
Install Assembly ..\..\..\..\Interfaces\Master Interfaces\ASCOM.Interfaces.dll to Global Assembly Cache
Comment: Install Assembly ..\..\..\..\Releases\ASCOM 6\Platform\Files\ASCOM.Exceptions.dll to Global Assembly Cache
Install Assembly ..\..\..\..\Interfaces\HelperPIAs\ASCOM.Helper.dll to Global Assembly Cache
Install Assembly ..\..\..\..\Interfaces\HelperPIAs\ASCOM.Helper2.dll to Global Assembly Cache
Comment: Platform 5 simulators
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\CCDSimulator.dll to $COMMONFILES$\ASCOM\Camera
Install Files ..\..\..\..\Drivers and Simulators\CCD Simulator\UNURANReadMe.txt to $COMMONFILES$\ASCOM\Camera
Install Files ..\..\..\..\Drivers and Simulators\CCD Simulator\unuran-0.6.0.dll to $COMMONFILES$\ASCOM\Camera
Install Files ..\..\..\..\Drivers and Simulators\Dome Simulator\DomeSim.exe to $COMMONFILES$\ASCOM\Dome
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\Astro32.dll to $COMMONFILES$\ASCOM\Dome
Install Files ..\..\..\..\Drivers and Simulators\Filter Wheel Simulator\FilterWheelSim.exe to $COMMONFILES$\ASCOM\FilterWheel
Install Files ..\..\..\..\Drivers and Simulators\Focus Simulator\FocusSim.exe to $COMMONFILES$\ASCOM\Focuser
Install Files ..\..\..\..\Drivers and Simulators\Switch Simulator\SwitchSim.exe to $COMMONFILES$\ASCOM\Switch
Install Files ..\..\..\..\Drivers and Simulators\Scope Simulator\ScopeSim.exe to $COMMONFILES$\ASCOM\Telescope
Install Files ..\..\..\..\Drivers and Simulators\Scope Simulator\ScopeSimHelp.htm to $COMMONFILES$\ASCOM\Telescope
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\Astro32.dll to $COMMONFILES$\ASCOM\Telescope
if Variable INSTALL_DOMECONTROLHUB Equals TRUE
  Install Files ..\..\..\..\Drivers and Simulators\ASCOMDome\ASCOMDome.exe to $COMMONFILES$\ASCOM\Dome
end
if Variable INSTALL_PIPE Equals TRUE
  Install Files ..\..\..\..\Pipe\Pipe.exe to $COMMONFILES$\ASCOM\Telescope
  Install Files ..\..\..\..\Pipe\PipeHubHelp.htm to $COMMONFILES$\ASCOM\Telescope
end
if Variable INSTALL_HUB Equals TRUE
  Install Files ..\..\..\..\Pipe\Hub.exe to $COMMONFILES$\ASCOM\Telescope
end
if Variable INSTALL_POTH Equals TRUE
  Install Files ..\..\..\..\POTH\Source\POTH\POTH.exe to $COMMONFILES$\ASCOM\Telescope
  Install Files ..\..\..\..\POTH\Source\POTH\POTHHelp.htm to $COMMONFILES$\ASCOM\Telescope
end
[END REGION]
 
[DEFINE REGION: Platform 5.5 files]
Comment: Updated helpers that use Platform 5.5 support
Install Files ..\..\..\..\ASCOM.Utilities\VB6Helper\Helper.dll to $COMMONFILES$\ASCOM
Install Files ..\..\..\..\ASCOM.Utilities\VB6Helper2\Helper2.dll to $COMMONFILES$\ASCOM
Comment: New files in Platform 5.5
Install Assembly ..\..\..\..\Releases\ASCOM 6\Platform\Files\Platform 5.5\ASCOM.Attributes.dll to Global Assembly Cache
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\Platform 5.5\ASCOM.Attributes.pdb to $COMMONFILES$\ASCOM\Platform\v5.5
Comment: Updated ASCOM.Exceptions v1.1 for Platform 5.5
Comment: Install Assembly ..\..\..\..\Releases\ASCOM 6\Platform\Files\Platform 5.5\ASCOM.Exceptions.dll to Global Assembly Cache
Comment: Copy Utilities and DriverAccess to .Net directory to ensure Inno installers that test for this run OK
Comment: The ASCOM.Utilities.dll file MUST be the original from Platform 5.5 because at least 1 installer checks the file version of the installed file!
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\Platform 5.5\ASCOM.Utilities.dll to $COMMONFILES$\ASCOM\.net
Install Files ..\..\..\..\ASCOM.DriverAccess.Platform5\bin\Release\ASCOM.DriverAccess.dll to $COMMONFILES$\ASCOM\.net
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\Docs\These files are not in use - ReadMe.txt to $COMMONFILES$\ASCOM\.net
[END REGION]
 
[DEFINE REGION: Platform 6 files]
Comment: Install exceptions redirection policy
Install Files ..\..\..\..\ASCOM Redirection Policies\policy.1.0.ASCOM.Exceptions.dll to $COMMONFILES$\ASCOM\Platform\v6.0
Install Files ..\..\..\..\ASCOM Redirection Policies\policy.1.1.ASCOM.Exceptions.dll to $COMMONFILES$\ASCOM\Platform\v6.0
Install Files ..\..\..\..\ASCOM Redirection Policies\ExceptionsPolicy.xml to $COMMONFILES$\ASCOM\Platform\v6.0
Comment: Updated Utiities 5.5.6 to replace 5.5.1 that access registry rather than XML files, otherwise unchanged
Install Assembly ..\..\..\..\ASCOM.Utilities\ASCOM.Utilities.556\bin\Release\ASCOM.Utilities.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.Utilities\ASCOM.Utilities.556\bin\Release\ASCOM.Utilities.pdb to $COMMONFILES$\ASCOM\Platform\v5.5
Install Files ..\..\..\..\ASCOM.Utilities\ASCOM.Utilities.556\Publisher Policy 5.5.6\policy.5.5.ASCOM.Utilities.dll to $COMMONFILES$\ASCOM\Platform\v5.5
Install Files ..\..\..\..\ASCOM.Utilities\ASCOM.Utilities.556\Publisher Policy 5.5.6\UtilitiesPolicy.xml to $COMMONFILES$\ASCOM\Platform\v5.5
Comment: Updated driver access v1.0.6 to improve compatibility with Platform 5 drivers
Install Assembly ..\..\..\..\ASCOM.DriverAccess.Platform5\bin\Release\ASCOM.DriverAccess.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.DriverAccess.Platform5\bin\Release\ASCOM.DriverAccess.pdb to $COMMONFILES$\ASCOM\Platform\v5.5
Comment: Platform 6 core components
Install Assembly ..\..\..\..\ASCOM.DriverAccess\bin\Release\ASCOM.DriverAccess.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.DriverAccess\bin\Release\ASCOM.DriverAccess.pdb to $WINDIR$\Symbols\dll
Install Assembly ..\..\..\..\ASCOM.DeviceInterface\bin\Release\ASCOM.DeviceInterfaces.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.DeviceInterface\bin\Release\ASCOM.DeviceInterfaces.dll to $COMMONFILES$\ASCOM\Platform\v6
Install Files ..\..\..\..\ASCOM.DeviceInterface\bin\Release\ASCOM.DeviceInterfaces.pdb to $WINDIR$\Symbols\dll
Install Assembly ..\..\..\..\Interfaces\ASCOMExceptions\bin\Release\net35\ASCOM.Exceptions.dll to Global Assembly Cache
Install Files ..\..\..\..\Interfaces\ASCOMExceptions\bin\Release\net35\ASCOM.Exceptions.dll to $COMMONFILES$\ASCOM\Platform\v6
Install Files ..\..\..\..\Interfaces\ASCOMExceptions\bin\Release\net35\ASCOM.Exceptions.pdb to $WINDIR$\Symbols\dll
Install Assembly ..\..\..\..\ASCOM.Utilities\ASCOM.Utilities\bin\Release\ASCOM.Utilities.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.Utilities\ASCOM.Utilities\bin\Release\ASCOM.Utilities.pdb to $WINDIR$\Symbols\dll
Install Files ..\..\..\..\ASCOM.Utilities\ASCOM.Utilities\bin\Release\ASCOM.Utilities.dll to $COMMONFILES$\ASCOM\Platform\v6
Comment: Tim Long Platform 6 components
Install Assembly ..\..\..\..\ASCOM.Controls\ASCOM.Controls\bin\Release\ASCOM.Controls.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.Controls\ASCOM.Controls\bin\Release\ASCOM.Controls.pdb to $WINDIR$\Symbols\dll
Install Assembly ..\..\..\..\ASCOM.SettingsProvider\ASCOM.SettingsProvider\bin\Release\ASCOM.SettingsProvider.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.SettingsProvider\ASCOM.SettingsProvider\bin\Release\ASCOM.SettingsProvider.pdb to $WINDIR$\Symbols\dll
Install Assembly ..\..\..\..\ASCOM.Attributes\bin\Release\ASCOM.Attributes.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.Attributes\bin\Release\ASCOM.Attributes.pdb to $WINDIR$\Symbols\dll
Comment: Platform 6 Astrometry
Install Assembly ..\..\..\..\ASCOM.Astrometry\ASCOM.Astrometry\bin\Release\ASCOM.Astrometry.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.Astrometry\ASCOM.Astrometry\bin\Release\ASCOM.Astrometry.pdb to $WINDIR$\Symbols\dll
Install Files ..\..\..\..\ASCOM.Astrometry\ASCOM.Astrometry\bin\Release\ASCOM.Astrometry.dll to $COMMONFILES$\ASCOM\Platform\v6
Install Assembly ..\..\..\..\ASCOM.Astrometry\ASCOM.Astrometry556\bin\Release\ASCOM.Astrometry.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.Astrometry\ASCOM.Astrometry556\bin\Release\ASCOM.Astrometry.pdb to $COMMONFILES$\ASCOM\Platform\v5.5
Install Files ..\..\..\..\ASCOM.Astrometry\ASCOM.Astrometry556\Platform 5.5 Redirection Policy\policy.5.5.ASCOM.Astrometry.dll to $COMMONFILES$\ASCOM\Platform\v5.5
Install Files ..\..\..\..\ASCOM.Astrometry\ASCOM.Astrometry556\Platform 5.5 Redirection Policy\AstrometryPolicy.xml to $COMMONFILES$\ASCOM\Platform\v5.5
Install Files ..\..\..\..\NOVAS\NOVAS-3\NOVAS3\Win32\Release\NOVAS3.dll to $COMMONFILES$\ASCOM\Astrometry
Install Files ..\..\..\..\NOVAS\NOVAS-3\NOVAS3\Win32\Release\NOVAS3.pdb to $COMMONFILES$\ASCOM\Astrometry
Install Files ..\..\..\..\NOVAS\NOVAS-3\NOVAS3\x64\Release\NOVAS3-64.dll to $COMMONFILES$\ASCOM\Astrometry
Install Files ..\..\..\..\NOVAS\NOVAS-3\NOVAS3\x64\Release\NOVAS3-64.pdb to $COMMONFILES$\ASCOM\Astrometry
Install Files ..\..\..\..\NOVAS\NOVAS-3\CioFile\cio_ra.bin to $COMMONFILES$\ASCOM\Astrometry
Install Files ..\..\..\..\ASCOM.Astrometry\JPL Ephemeris 421\JPLEPH to $COMMONFILES$\ASCOM\Astrometry
Install Files ..\..\..\..\NOVAS\NOVAS-C\Win32\Release\NOVAS-C.dll to $COMMONFILES$\ASCOM\Astrometry
Install Files ..\..\..\..\NOVAS\NOVAS-C\Win32\Release\NOVAS-C.pdb to $COMMONFILES$\ASCOM\Astrometry
Install Files ..\..\..\..\NOVAS\NOVAS-C\x64\Release\NOVAS-C64.dll to $COMMONFILES$\ASCOM\Astrometry
Install Files ..\..\..\..\NOVAS\NOVAS-C\x64\Release\NOVAS-C64.pdb to $COMMONFILES$\ASCOM\Astrometry
Comment: Platform 6 SP1 Astrometry
Install Files ..\..\..\..\NOVAS\NOVAS-31\NOVAS3\Win32\Release\NOVAS31.dll to $COMMONFILES$\ASCOM\Astrometry
Install Files ..\..\..\..\NOVAS\NOVAS-31\NOVAS3\Win32\Release\NOVAS31.pdb to $COMMONFILES$\ASCOM\Astrometry
Install Files ..\..\..\..\NOVAS\NOVAS-31\NOVAS3\x64\Release\NOVAS31-64.dll to $COMMONFILES$\ASCOM\Astrometry
Install Files ..\..\..\..\NOVAS\NOVAS-31\NOVAS3\x64\Release\NOVAS31-64.pdb to $COMMONFILES$\ASCOM\Astrometry
Comment: Install Files ..\..\..\..\NOVAS\NOVAS-3\CioFile\cio_ra.bin to $COMMONFILES$\ASCOM\Astrometry
Comment: Platform 6 Internal
Install Files ..\..\..\..\ASCOM.Utilities\MigrateProfile\bin\Release\MigrateProfile.exe to $COMMONFILES$\ASCOM\Platform\Internal
Install Files ..\..\..\..\GACInstall\bin\Release\ASCOM.Internal.GACInstall.exe to $COMMONFILES$\ASCOM\Platform\Internal
Install Assembly ..\..\..\..\ASCOM.Utilities\FusionLib\bin\Release\ASCOM.Internal.FusionLib.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.Utilities\FusionLib\bin\Release\ASCOM.Internal.FusionLib.pdb to $WINDIR$\Symbols\dll
Install Assembly ..\..\..\..\ASCOM.Internal.Extensions\bin\Release\ASCOM.Internal.Extensions.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.Internal.Extensions\bin\Release\ASCOM.Internal.Extensions.pdb to $WINDIR$\Symbols\dll
Comment: Platform 6 Tools
Install Files ..\..\..\..\ShowPlatformVersion.vbs to $COMMONFILES$\ASCOM
Install Files ..\..\..\..\ASCOM.Utilities\ASCOM Diagnostics\bin\Release\ASCOM Diagnostics.pdb to $WINDIR$\Symbols\dll
Install Files ..\..\..\..\ASCOM.Utilities\ASCOM Diagnostics\bin\Release\ASCOM Diagnostics.exe to $TARGETDIR$\Tools
Install Files ..\..\..\..\ASCOM.Utilities\ASCOM Diagnostics\bin\Release\ASCOM Diagnostics.pdb to $TARGETDIR$\Tools
Install Files ..\..\..\..\ASCOM.Utilities\ASCOM Diagnostics\bin\Release\ASCOM Diagnostics.xml to $TARGETDIR$\Tools
Install Files ..\..\..\..\ASCOM.Utilities\ASCOM Diagnostics\Ceres.chby to $TARGETDIR$\Tools
Install Files ..\..\..\..\ASCOM.DriverConnect\bin\Release\x64\ASCOM.DriverConnect.exe to $TARGETDIR$\Tools\DriverConnect64
Install Files ..\..\..\..\ASCOM.DriverConnect\bin\Release\x64\ASCOM.DriverConnect.pdb to $TARGETDIR$\Tools\DriverConnect64
Install Files ..\..\..\..\ASCOM.DriverConnect\bin\Release\x86\ASCOM.DriverConnect.exe to $TARGETDIR$\Tools\DriverConnect32
Install Files ..\..\..\..\ASCOM.DriverConnect\bin\Release\x86\ASCOM.DriverConnect.pdb to $TARGETDIR$\Tools\DriverConnect32
Install Files ..\..\..\..\ASCOM.Utilities\Profile Explorer\bin\Release\ProfileExplorer.pdb to $WINDIR$\Symbols\dll
Install Files ..\..\..\..\ASCOM.Utilities\Profile Explorer\bin\Release\ProfileExplorer.exe to $TARGETDIR$\Tools
Install Files ..\..\..\..\ASCOM.Utilities\Profile Explorer\bin\Release\ProfileExplorer.pdb to $TARGETDIR$\Tools
Install Files ..\..\..\..\ASCOM.Utilities\Profile Explorer\bin\Release\ProfileExplorer.xml to $TARGETDIR$\Tools
Comment: Platform 6 Simulators
Comment: Camera simulator
Install Files ..\..\..\..\Drivers and Simulators\CameraSimulator.NET\CameraSimulator\bin\Release\ASCOM.Simulator.Camera.dll to $COMMONFILES$\ASCOM\Camera\ASCOM.Simulator.Camera
Install Files ..\..\..\..\Drivers and Simulators\CameraSimulator.NET\CameraSimulator\bin\Release\ASCOM.Simulator.Camera.pdb to $COMMONFILES$\ASCOM\Camera\ASCOM.Simulator.Camera
Install Files ..\..\..\..\Drivers and Simulators\CameraSimulator.NET\CameraSimulator\M42-800x600.jpg to $COMMONFILES$\ASCOM\Camera\ASCOM.Simulator.Camera
Install Files ..\..\..\..\Drivers and Simulators\CameraSimulator.NET\CameraSimulator\Testcard_F.jpg to $COMMONFILES$\ASCOM\Camera\ASCOM.Simulator.Camera
Comment: FilterWheel simulator
Install Files ..\..\..\..\Drivers and Simulators\FilterWheel Simulator .NET\FilterWheelDriver\bin\x86\Release\ASCOM.FilterWheelSim.exe to $COMMONFILES$\ASCOM\FilterWheel\ASCOM.FilterWheelSim
Install Files ..\..\..\..\Drivers and Simulators\FilterWheel Simulator .NET\FilterWheelDriver\bin\x86\Release\ASCOM.FilterWheelSim.pdb to $COMMONFILES$\ASCOM\FilterWheel\ASCOM.FilterWheelSim
Install Files ..\..\..\..\Drivers and Simulators\FilterWheel Simulator .NET\FilterWheelDriver\bin\x86\Release\ASCOM.Simulator.FilterWheel.dll to $COMMONFILES$\ASCOM\FilterWheel\ASCOM.FilterWheelSim
Install Files ..\..\..\..\Drivers and Simulators\FilterWheel Simulator .NET\FilterWheelDriver\bin\x86\Release\ASCOM.Simulator.FilterWheel.pdb to $COMMONFILES$\ASCOM\FilterWheel\ASCOM.FilterWheelSim
Comment: Focuser simulator
Install Files ..\..\..\..\Drivers and Simulators\Focus Simulator 2010\FocuserSimulatorDriver\bin\Release\ASCOM.Simulator.Focuser.dll to $COMMONFILES$\ASCOM\Focuser\ASCOM.Simulator.Focuser
Install Files ..\..\..\..\Drivers and Simulators\Focus Simulator 2010\FocuserSimulatorDriver\bin\Release\ASCOM.Simulator.Focuser.pdb to $COMMONFILES$\ASCOM\Focuser\ASCOM.Simulator.Focuser
Comment: CoverCalibrator simulator
Install Files ..\..\..\..\Drivers and Simulators\CoverCalibrator Simulator\bin\Release\ASCOM.Simulator.CoverCalibrator.dll to $COMMONFILES$\ASCOM\CoverCalibrator\ASCOM.Simulator.CoverCalibrator
Install Files ..\..\..\..\Drivers and Simulators\CoverCalibrator Simulator\bin\Release\ASCOM.Simulator.CoverCalibrator.pdb to $COMMONFILES$\ASCOM\CoverCalibrator\ASCOM.Simulator.CoverCalibrator
Comment: SafetyMonitor simulator
Install Files ..\..\..\..\drivers and simulators\safetymonitor simulator\bin\release\ASCOM.Simulator.SafetyMonitor.dll to $COMMONFILES$\ASCOM\SafetyMonitor\ASCOM.Simulator.SafetyMonitor
Install Files ..\..\..\..\drivers and simulators\safetymonitor simulator\bin\release\ASCOM.Simulator.SafetyMonitor.pdb to $COMMONFILES$\ASCOM\SafetyMonitor\ASCOM.Simulator.SafetyMonitor
Comment: Telescope simulator
Install Files ..\..\..\..\Drivers and Simulators\Telescope Simulator .NET\TelescopeSimulator\bin\x86\Release\ASCOM.TelescopeSimulator.exe to $COMMONFILES$\ASCOM\Telescope\ASCOM.TelescopeSimulator
Install Files ..\..\..\..\Drivers and Simulators\Telescope Simulator .NET\TelescopeSimulator\bin\x86\Release\ASCOM.TelescopeSimulator.pdb to $COMMONFILES$\ASCOM\Telescope\ASCOM.TelescopeSimulator
Install Files ..\..\..\..\Drivers and Simulators\Telescope Simulator .NET\TelescopeSimulator\bin\x86\Release\ASCOM.Simulator.Telescope.dll to $COMMONFILES$\ASCOM\Telescope\ASCOM.TelescopeSimulator
Install Files ..\..\..\..\Drivers and Simulators\Telescope Simulator .NET\TelescopeSimulator\bin\x86\Release\ASCOM.Simulator.Telescope.pdb to $COMMONFILES$\ASCOM\Telescope\ASCOM.TelescopeSimulator
Comment: Rotator simulator
Install Files ..\..\..\..\Drivers and Simulators\Rotator Simulator\RotatorServer\bin\Release\ASCOM.RotatorSimulator.exe to $COMMONFILES$\ASCOM\Rotator\ASCOM.RotatorSimulator
Install Files ..\..\..\..\Drivers and Simulators\Rotator Simulator\RotatorServer\bin\Release\ASCOM.RotatorSimulator.pdb to $COMMONFILES$\ASCOM\Rotator\ASCOM.RotatorSimulator
Install Files ..\..\..\..\Drivers and Simulators\Rotator Simulator\RotatorServer\bin\Release\ASCOM.Simulator.Rotator.dll to $COMMONFILES$\ASCOM\Rotator\ASCOM.RotatorSimulator
Install Files ..\..\..\..\Drivers and Simulators\Rotator Simulator\RotatorServer\bin\Release\ASCOM.Simulator.Rotator.pdb to $COMMONFILES$\ASCOM\Rotator\ASCOM.RotatorSimulator
Comment: Dome simulator
Install Files ..\..\..\..\Drivers and Simulators\Dome Simulator .NET\bin\Release\ASCOM.Simulator.Dome.dll to $COMMONFILES$\ASCOM\Dome\ASCOM.Simulator.Dome
Install Files ..\..\..\..\Drivers and Simulators\Dome Simulator .NET\bin\Release\ASCOM.Simulator.Dome.pdb to $COMMONFILES$\ASCOM\Dome\ASCOM.Simulator.Dome
Comment: Platform Update Checker
Install Files ..\..\..\..\CheckForUpdates.js to $TARGETDIR$\Tools
[END REGION]
 
[DEFINE REGION: Platform 6.1 files]
Comment: Video utilities
Install Assembly ..\..\..\..\ASCOM.Utilities.Video\bin\Release\ASCOM.Utilities.Video.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.Utilities.Video\bin\Release\ASCOM.Utilities.Video.pdb to $WINDIR$\Symbols\dll
Install Files ..\..\..\..\ASCOM.Utilities.Video\bin\Release\ASCOM.Utilities.Video.dll to $COMMONFILES$\ASCOM\Platform\v6.1
Comment: Video Simulator
Install Files ..\..\..\..\Drivers and Simulators\ASCOM.Simulator.Video\bin\Release\ASCOM.Simulator.Video.dll to $COMMONFILES$\ASCOM\Video\ASCOM.Simulator.Video
Install Files ..\..\..\..\Drivers and Simulators\ASCOM.Simulator.Video\bin\Release\ASCOM.Simulator.Video.pdb to $COMMONFILES$\ASCOM\Video\ASCOM.Simulator.Video
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\DirectShowLib\DirectShowLib-2005.dll to $COMMONFILES$\ASCOM\Video\ASCOM.Simulator.Video
Install Files ..\..\..\..\Drivers and Simulators\ASCOM.Simulator.Video\bin\Release\Resources\simulator.pix to $COMMONFILES$\ASCOM\Video\ASCOM.Simulator.Video\Resources
Comment: Video Utilities - Native Helpers
Install Files ..\..\..\..\ASCOM.Utilities.Video.NativeHelpers\Release\Win32\ASCOM.NativeVideo32.dll to $COMMONFILES$\ASCOM\VideoUtilities
Install Files ..\..\..\..\ASCOM.Utilities.Video.NativeHelpers\Release\Win32\ASCOM.NativeVideo32.pdb to $COMMONFILES$\ASCOM\VideoUtilities
Install Files ..\..\..\..\ASCOM.Utilities.Video.NativeHelpers\Release\X64\ASCOM.NativeVideo64.dll to $COMMONFILES$\ASCOM\VideoUtilities
Install Files ..\..\..\..\ASCOM.Utilities.Video.NativeHelpers\Release\X64\ASCOM.NativeVideo64.pdb to $COMMONFILES$\ASCOM\VideoUtilities
Comment: Direct Video 2005
Install Assembly ..\..\..\..\Releases\ASCOM 6\Platform\Files\DirectShowLib\DirectShowLib-2005.dll to Global Assembly Cache
Comment: Switch V2 simulator
Install Files ..\..\..\..\Drivers and Simulators\SwitchV2 Simulator\SwitchServer\bin\Release\ASCOM.Simulator.Server.exe to $COMMONFILES$\ASCOM\Switch\Switch V2
Install Files ..\..\..\..\Drivers and Simulators\SwitchV2 Simulator\SwitchServer\bin\Release\ASCOM.Simulator.Server.pdb to $COMMONFILES$\ASCOM\Switch\Switch V2
Install Files ..\..\..\..\Drivers and Simulators\SwitchV2 Simulator\SwitchServer\bin\Release\ASCOM.Simulator.Server.exe.config to $COMMONFILES$\ASCOM\Switch\Switch V2
Install Files ..\..\..\..\Drivers and Simulators\SwitchV2 Simulator\SwitchServer\bin\Release\ASCOM.Simulator.Switch.dll to $COMMONFILES$\ASCOM\Switch\Switch V2
Install Files ..\..\..\..\Drivers and Simulators\SwitchV2 Simulator\SwitchServer\bin\Release\ASCOM.Simulator.Switch.pdb to $COMMONFILES$\ASCOM\Switch\Switch V2
Install Files ..\..\..\..\Drivers and Simulators\SwitchV2 Simulator\SwitchServer\bin\Release\ASCOM.Simulator.Switch.dll.config to $COMMONFILES$\ASCOM\Switch\Switch V2
Comment: Platform 6.1 SP1 SOFA Files
Install Files ..\..\..\..\SOFA\SOFA Library\Win32\Release\SOFA.dll to $COMMONFILES$\ASCOM\Astrometry
Install Files ..\..\..\..\SOFA\SOFA Library\Win32\Release\SOFA.pdb to $WINDIR$\Symbols\dll
Install Files ..\..\..\..\SOFA\Sofa Test Application\Win32\Release\SofaTestApplication-32.exe to $COMMONFILES$\ASCOM\Astrometry
Install Files ..\..\..\..\SOFA\SOFA Library\x64\Release\SOFA-64.dll to $COMMONFILES$\ASCOM\Astrometry
Install Files ..\..\..\..\SOFA\SOFA Library\x64\Release\SOFA-64.pdb to $WINDIR$\Symbols\dll
Install Files ..\..\..\..\SOFA\SOFA Test Application\x64\Release\SofaTestApplication-64.exe to $COMMONFILES$\ASCOM\Astrometry
[END REGION]
 
[DEFINE REGION: Platform 6.2 files]
Comment: Platform 6.2 ObservingConditions Hub
Install Files ..\..\..\..\Drivers and Simulators\ObservingConditions Hub\OCH Server\bin\Release\ASCOM.OCH.ObservingConditions.dll to $COMMONFILES$\ASCOM\ObservingConditions\OCH
Install Files ..\..\..\..\Drivers and Simulators\ObservingConditions Hub\OCH Server\bin\Release\ASCOM.OCH.ObservingConditions.pdb to $COMMONFILES$\ASCOM\ObservingConditions\OCH
Install Files ..\..\..\..\Drivers and Simulators\ObservingConditions Hub\OCH Server\bin\Release\ASCOM.OCH.ObservingConditions.dll.config to $COMMONFILES$\ASCOM\ObservingConditions\OCH
Install Files ..\..\..\..\Drivers and Simulators\ObservingConditions Hub\OCH Server\bin\Release\ASCOM.OCH.Server.exe to $COMMONFILES$\ASCOM\ObservingConditions\OCH
Install Files ..\..\..\..\Drivers and Simulators\ObservingConditions Hub\OCH Server\bin\Release\ASCOM.OCH.Server.exe.config to $COMMONFILES$\ASCOM\ObservingConditions\OCH
Install Files ..\..\..\..\Drivers and Simulators\ObservingConditions Hub\OCH Server\bin\Release\ASCOM.OCH.Server.pdb to $COMMONFILES$\ASCOM\Switch\ObservingConditions\OCH
Install Files ..\..\..\..\Drivers and Simulators\ObservingConditions Hub\OCH Test\bin\Release\ASCOM.OCH.Test.exe to $COMMONFILES$\ASCOM\ObservingConditions\OCH
Install Files ..\..\..\..\Drivers and Simulators\ObservingConditions Hub\OCH Test\bin\Release\ASCOM.OCH.Test.pdb to $COMMONFILES$\ASCOM\ObservingConditions\OCH
Install Files ..\..\..\..\Drivers and Simulators\ObservingConditions Simulator\OC Simulator Server\bin\Release\ASCOM.Simulator.ObservingConditions.dll to $COMMONFILES$\ASCOM\ObservingConditions\Simulator
Install Files ..\..\..\..\Drivers and Simulators\ObservingConditions Simulator\OC Simulator Server\bin\Release\ASCOM.Simulator.ObservingConditions.pdb to $COMMONFILES$\ASCOM\ObservingConditions\Simulator
Install Files ..\..\..\..\Drivers and Simulators\ObservingConditions Simulator\OC Simulator Server\bin\Release\ASCOM.OCSimulator.Server.exe to $COMMONFILES$\ASCOM\ObservingConditions\Simulator
Install Files ..\..\..\..\Drivers and Simulators\ObservingConditions Simulator\OC Simulator Server\bin\Release\ASCOM.OCSimulator.Server.exe.config to $COMMONFILES$\ASCOM\ObservingConditions\Simulator
Install Files ..\..\..\..\Drivers and Simulators\ObservingConditions Simulator\OC Simulator Server\bin\Release\ASCOM.OCSimulator.Server.pdb to $COMMONFILES$\ASCOM\ObservingConditions\Simulator
Install Files ..\..\..\..\Drivers and Simulators\ObservingConditions Simulator\OC Simulator Test\bin\Release\ASCOM.OCSimulator.Test.exe to $COMMONFILES$\ASCOM\ObservingConditions\Simulator
Install Files ..\..\..\..\Drivers and Simulators\ObservingConditions Simulator\OC Simulator Test\bin\Release\ASCOM.OCSimulator.Test.pdb to $COMMONFILES$\ASCOM\ObservingConditions\Simulator
Install Files ..\..\..\..\Drivers and Simulators\OpenWeatherMap\OpenWeatherMap\bin\Release\ASCOM.OpenWeatherMap.ObservingConditions.dll to $COMMONFILES$\ASCOM\ObservingConditions\OpenWeatherMap
Install Files ..\..\..\..\Drivers and Simulators\OpenWeatherMap\OpenWeatherMap\bin\Release\ASCOM.OpenWeatherMap.ObservingConditions.dll.config to $COMMONFILES$\ASCOM\ObservingConditions\OpenWeatherMap
Install Files ..\..\..\..\Drivers and Simulators\OpenWeatherMap\OpenWeatherMap\bin\Release\ASCOM.OpenWeatherMap.ObservingConditions.pdb to $COMMONFILES$\ASCOM\ObservingConditions\OpenWeatherMap
[END REGION]
 
[DEFINE REGION: ASCOM Cache]
Install Assembly ..\..\..\..\ASCOM.Utilities\ASCOM.Cache\bin\Release\ASCOM.Cache.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.Utilities\ASCOM.Cache\bin\Release\ASCOM.Cache.pdb to $WINDIR$\Symbols\dll
Install Files ..\..\..\..\ASCOM.Utilities\ASCOM.Cache\bin\Release\ASCOM.Cache.dll to $COMMONFILES$\ASCOM\Platform\v6.4
[END REGION]
 
[DEFINE REGION: Earth Rotation Date Update]
Install Files ..\..\..\..\ASCOM.Astrometry\EarthRotationUpdate\bin\Release\EarthRotationUpdate.exe to $TARGETDIR$\Tools
Install Files ..\..\..\..\ASCOM.Astrometry\EarthRotationUpdate\bin\Release\EarthRotationUpdate.pdb to $TARGETDIR$\Tools
Install Files ..\..\..\..\ASCOM.Utilities\ASCOM Diagnostics\bin\Release\Microsoft.Win32.TaskScheduler.dll to $TARGETDIR$\Tools
[END REGION]
 
[DEFINE REGION: Alpaca Support for Chooser]
Comment: Add Alpaca support assemblies to the GAC
Install Assembly ..\..\..\..\ASCOM.Utilities\ASCOM.Newtonsoft.Json\bin\Release\net35\ASCOM.Newtonsoft.Json.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.Utilities\ASCOM.Newtonsoft.Json\bin\Release\net35\ASCOM.Newtonsoft.Json.pdb to $WINDIR$\Symbols\dll
Install Assembly ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\Alpaca Shared Resources\bin\Release\ASCOM.AlpacaSharedResources.dll to Global Assembly Cache
Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\Alpaca Shared Resources\bin\Release\ASCOM.AlpacaSharedResources.pdb to $WINDIR$\Symbols\dll
Comment: Add the dynamic client driver files
Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\Alpaca Client Local Server\bin\Release\ASCOM.AlpacaClientLocalServer.exe to $COMMONFILES$\ASCOM\AlpacaDynamicClients
Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\Alpaca Client Local Server\bin\Release\ASCOM.AlpacaClientLocalServer.pdb to $WINDIR$\Symbols\dll
Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\Alpaca Client Local Server\bin\Release\ASCOM.AlpacaClientLocalServer.exe.config to $COMMONFILES$\ASCOM\AlpacaDynamicClients
Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\Alpaca Client Device Base Classes\bin\Release\ASCOM.AlpacaClientDeviceBaseClasses.dll to $COMMONFILES$\ASCOM\AlpacaDynamicClients
Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\Alpaca Client Device Base Classes\bin\Release\ASCOM.AlpacaClientDeviceBaseClasses.pdb to $COMMONFILES$\ASCOM\AlpacaDynamicClients
Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\Alpaca Client Device Base Classes\bin\Release\RestSharp.dll to $COMMONFILES$\ASCOM\AlpacaDynamicClients
Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\Alpaca Client Device Base Classes\bin\Release\ASCOM.Alpaca.dll to $COMMONFILES$\ASCOM\AlpacaDynamicClients
Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\Alpaca Client Device Base Classes\bin\Release\ASCOM.Common.dll to $COMMONFILES$\ASCOM\AlpacaDynamicClients
Comment: Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\Alpaca Client Device Base Classes\bin\Release\ASCOM.Tools.dll to $COMMONFILES$\ASCOM\AlpacaDynamicClients
Comment: Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\Alpaca Client Device Base Classes\bin\Release\Newtonsoft.Json.dll to $COMMONFILES$\ASCOM\AlpacaDynamicClients
Comment: Add the client creator executable and the dependencies that must be present in order to allow the dynamic compilation to succeed
Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\ASCOM.AlpacaDynamicClientManager\bin\Release\ASCOM.AlpacaDynamicClientManager.exe to $TARGETDIR$\Tools\AlpacaDynamicClientManager
Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\ASCOM.AlpacaDynamicClientManager\bin\Release\ASCOM.AlpacaDynamicClientManager.pdb to $TARGETDIR$\Tools\AlpacaDynamicClientManager
Install Files ..\..\..\..\ASCOM.Attributes\bin\Release\ASCOM.Attributes.dll to $TARGETDIR$\Tools\AlpacaDynamicClientManager
Install Files ..\..\..\..\ASCOM.DeviceInterface\bin\Release\ASCOM.DeviceInterfaces.dll to $TARGETDIR$\Tools\AlpacaDynamicClientManager
Install Files ..\..\..\..\ASCOM.Utilities\ASCOM.Newtonsoft.Json\bin\Release\net35\ASCOM.Newtonsoft.Json.dll to $TARGETDIR$\Tools\AlpacaDynamicClientManager
Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\ASCOM.AlpacaDynamicClientManager\bin\Release\RestSharp.dll to $TARGETDIR$\Tools\AlpacaDynamicClientManager
Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\Alpaca Client Device Base Classes\bin\Release\ASCOM.AlpacaClientDeviceBaseClasses.dll to $TARGETDIR$\Tools\AlpacaDynamicClientManager
Install Files ..\..\..\..\ASCOM.Utilities\AlpacaDynamicClients\Alpaca Client Local Server\bin\Release\ASCOM.AlpacaClientLocalServer.exe to $TARGETDIR$\Tools\AlpacaDynamicClientManager
[END REGION]
 
[DEFINE REGION: ASCOM Device Hub]
Install Files ..\..\..\..\Drivers and Simulators\ASCOM Device Hub\DeviceHub\bin\Release\ASCOM.DeviceHub.exe to $COMMONFILES$\ASCOM\DeviceHub
Install Files ..\..\..\..\Drivers and Simulators\ASCOM Device Hub\DeviceHub\bin\Release\ASCOM.DeviceHub.exe.config to $COMMONFILES$\ASCOM\DeviceHub
Install Files ..\..\..\..\Drivers and Simulators\ASCOM Device Hub\DeviceHub\bin\Release\ASCOM.DeviceHub.pdb to $COMMONFILES$\ASCOM\DeviceHub
Install Files ..\..\..\..\Drivers and Simulators\ASCOM Device Hub\DeviceHub\bin\Release\MvvmMessenger.dll to $COMMONFILES$\ASCOM\DeviceHub
Install Files ..\..\..\..\Drivers and Simulators\ASCOM Device Hub\DeviceHub\bin\Release\MvvmMessenger.pdb to $COMMONFILES$\ASCOM\DeviceHub
Install Files ..\..\..\..\Drivers and Simulators\ASCOM Device Hub\DeviceHub\bin\Release\PresentationFramework.Aero.dll to $COMMONFILES$\ASCOM\DeviceHub
Comment: Install Files ..\..\..\..\Drivers and Simulators\ASCOM Device Hub\TelescopeDriver\bin\Release\ASCOM.DeviceHub.Telescope.dll to $COMMONFILES$\ASCOM\DeviceHub
Comment: Install Files ..\..\..\..\Drivers and Simulators\ASCOM Device Hub\TelescopeDriver\bin\Release\ASCOM.DeviceHub.Telescope.pdb to $COMMONFILES$\ASCOM\DeviceHub
Comment: Install Files ..\..\..\..\Drivers and Simulators\ASCOM Device Hub\DomeDriver\bin\Release\ASCOM.DeviceHub.Dome.dll to $COMMONFILES$\ASCOM\DeviceHub
Comment: Install Files ..\..\..\..\Drivers and Simulators\ASCOM Device Hub\DomeDriver\bin\Release\ASCOM.DeviceHub.Dome.pdb to $COMMONFILES$\ASCOM\DeviceHub
Comment: Install Files ..\..\..\..\Drivers and Simulators\ASCOM Device Hub\FocuserDriver\bin\Release\ASCOM.DeviceHub.Focuser.dll to $COMMONFILES$\ASCOM\DeviceHub
Comment: Install Files ..\..\..\..\Drivers and Simulators\ASCOM Device Hub\FocuserDriver\bin\Release\ASCOM.DeviceHub.Focuser.pdb to $COMMONFILES$\ASCOM\DeviceHub
Install Files ..\..\..\..\Drivers and Simulators\ASCOM Device Hub\Documents\ASCOM Device Hub User and Technical Information.pdf to $COMMONFILES$\ASCOM\DeviceHub
[END REGION]
 
[DEFINE REGION: Platform validation]
Install Files ..\..\..\..\ValidatePlatform\bin\Release\ValidatePlatform.exe to $TARGETDIR$\Tools\Validation
Install Files ..\..\..\..\ValidatePlatform\bin\x64\Release\ValidatePlatform64.exe to $TARGETDIR$\Tools\Validation
[END REGION]
 
[DEFINE REGION: Platform 6 Content]
Comment: Platform 6 Documents
Install Files ..\Files\Help.ico to $COMMONFILES$\ASCOM\Platform
Install Files ..\Files\Internet.ico to $COMMONFILES$\ASCOM\Platform
Install Files ..\Files\ASCOM.ico to $COMMONFILES$\ASCOM\Platform
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\Compatible Software (web).url to $TARGETDIR$\Docs
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\Drivers and Downloads (web).url to $TARGETDIR$\Docs
Install Files ..\..\..\..\Help\Output\Platform\PlatformHelp.chm to $TARGETDIR$\Docs
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\Support (web).url to $TARGETDIR$\Docs
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\ASCOM User Guide.pdf to $TARGETDIR$\Docs
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\Supported Devices (web).url to $TARGETDIR$\Docs
Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\Docs\Bug72T-sm.jpg to $TARGETDIR$\Docs
[END REGION]
 
[DEFINE REGION: Set Registry Keys]
Comment: Install into 32bit registry, even on a 64bit system
Write into Text File $SETUPLOG$ from Value $TIME$ Installing 32bit Registry entries (at end of file)
 
Comment: Create registry keys
Write Registry Key HKLM\SOFTWARE\ASCOM\,  (permanent)
Comment: Apply Install (get result into variable SUCCESS)
Comment: Write into Text File $SETUPLOG$ from Value $TIME$ Created base registry key: $SUCCESS$ (at end of file)
Comment:  
Comment: Set Read Write Permissions on Registry Key "HKLM\SOFTWARE\ASCOM\" for BUILTIN\USERS
Comment: Apply Install (get result into variable SUCCESS)
Comment: Write into Text File $SETUPLOG$ from Value $TIME$ Set registry permissions: $SUCCESS$ (at end of file)
Comment:  
Write Registry Key HKLM\SOFTWARE\ASCOM\PlatformVersion, $PLATFORMVERSIONMAJOR$.$PLATFORMVERSIONMINOR$ (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Astrometry\,  (permanent)
Comment: Leap Seconds = UTC-TAI offset - needs to be updated every time a leap second is added or removed.
Comment: Value name changed from Leap Seconds to Manual Leap Seconds in Platform 6.4 so remove the old value
Delete Registry VALUE HKLM\SOFTWARE\ASCOM\Astrometry\Leap Seconds
Write Registry Key HKLM\SOFTWARE\ASCOM\Astrometry\Manual Leap Seconds, $LEAPSECONDS$
Comment: Force use of the ASCOM-STANDARDS download site because of unavailability of the USNO sites and the new NASA site security policy.
Write Registry Key HKLM\SOFTWARE\ASCOM\Astrometry\Download Task Data Source, https://download.ascom-standards.org/earthrot/
Write Registry Key HKLM\SOFTWARE\ASCOM\Camera Drivers\,  (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Camera Drivers\CCDSimulator.Camera\\, Simulator (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Chooser\,  (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\COMPortSettings\, Configuration for COM ports that require special handling (see Platform Help file for instructions)  (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\COMPortSettings\ForceCOMPorts\, List of COM ports that will always appear in the AvailableCOMPorts list (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\COMPortSettings\IgnoreCOMPorts\, List of COM ports that will be omitted from the AvailableCOMPorts scan (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\CoverCalibrator Drivers\,  (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Dome Drivers\,  (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Dome Drivers\DomeSim.Dome\\, Simulator (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Dome Drivers\Pipe.Dome\\, Pipe diagnostic tool (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Dome Drivers\Hub.Dome\\, Generic Hub (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Dome Drivers\POTH.Dome\\, POTH Hub (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\FilterWheel Drivers\,  (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\FilterWheel Drivers\FilterWheelSim.FilterWheel\, Simulator (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Focuser Drivers\,  (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Focuser Drivers\FocusSim.Focuser\\, Simulator (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Focuser Drivers\Hub.Focuser\\, Generic Hub (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Focuser Drivers\Pipe.Focuser\\, Pipe diagnostic tool (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Focuser Drivers\POTH.Focuser\\, POTH Hub (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\, List of applications requiring a specific value of Platform Version (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\ACLDome(5.0.1)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\ACLTelescope(5.0.1)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\AstroPhysics(4.1.25)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\Celestron(5.0.10)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\Celestron(5.0.13)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\Celestron(5.0.14)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\CyberDrive(5.0.1)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\GCUSB_nFOCUS Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\GCUSB_nFOCUS Setup_5_03.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\GCUSB_nFOCUS_Setup_505.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\GCUSB_nFOCUS_Setup_505_v5v6.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\GCUSB_nFOCUS_Setup_Two.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\GCUSB_nFOCUS_Setup_Two_5_03.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\GCUSB_nFOCUS_Setup_Two_505.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\GCUSB_nFOCUS_Setup_Two_505_v5v6.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\JMISmartFocus(4.0.1)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\LakesideAstro Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\LesveDome 5 0 27 Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\LittleFootClassic(1.0.0)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\LXPTelescope(5.0.1)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\MeadeClassic(5.0.3)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\MeadeLX200GPS(5.0.0)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\Optec IFW(1.1.0.1) Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\OptecPyxis(1.0.4)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\OptecTCF(4.1.0)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\PCTCSCombined(5.0.1)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\QHY8ASCOMSetup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\QHY9ASCOMSetup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\RoboFocus(3.0.9)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\ServoCAT(4.2.2)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\StarlightXpress Setup, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\TheSkyTelescope(5.0.1)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\TheSkyTelescope(5.0.2)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\TheSkyTelescope(5.0.3)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\VixenSS2k(5.1.4)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\VixenSS2k(5.1.6b)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersion\\VixenSS2K(5.1.7b)Setup.exe, 5.5
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\, List of applications requiring a localised decimal separator in the returned Platform Version value (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\ACLDome(5.0.1)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\ACLTelescope(5.0.1)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\AstroPhysics(4.1.25)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\Celestron(5.0.10)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\Celestron(5.0.13)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\Celestron(5.0.14)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\CyberDrive(5.0.1)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\GCUSB_nFOCUS Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\GCUSB_nFOCUS Setup_5_03.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\GCUSB_nFOCUS_Setup_505.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\GCUSB_nFOCUS_Setup_505_v5v6.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\GCUSB_nFOCUS_Setup_Two.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\GCUSB_nFOCUS_Setup_Two_5_03.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\GCUSB_nFOCUS_Setup_Two_505.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\GCUSB_nFOCUS_Setup_Two_505_v5v6.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\JMISmartFocus(4.0.1)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\LakesideAstro Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\LesveDome 5 0 27 Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\LittleFootClassic(1.0.0)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\LXPTelescope(5.0.1)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\MeadeClassic(5.0.3)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\MeadeLX200GPS(5.0.0)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\Optec IFW(1.1.0.1) Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\OptecPyxis(1.0.4)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\OptecTCF(4.1.0)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\PCTCSCombined(5.0.1)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\QHY8ASCOMSetup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\QHY9ASCOMSetup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\RoboFocus(3.0.9)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\ServoCAT(4.2.2)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\StarlightXpress Setup, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\TheSkyTelescope(5.0.1)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\TheSkyTelescope(5.0.2)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\TheSkyTelescope(5.0.3)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\VixenSS2k(5.1.4)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\VixenSS2k(5.1.6b)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\\VixenSS2K(5.1.7b)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForcePlatformVersionSeparator\TheSkyTelescope(5.2.7)Setup.exe, 
Write Registry Key HKLM\SOFTWARE\ASCOM\ForceSystemTimer\, List of applications for which Utiliites.Timer will employ a Systems.Timer timer in place of the default Forms timer. (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\ForceSystemTimer\WScript.Exe, True
Write Registry Key HKLM\SOFTWARE\ASCOM\ForceSystemTimer\Astroart.Exe, True
Write Registry Key HKLM\SOFTWARE\ASCOM\ObservingConditions Drivers\,  (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Platform\, Description of installed ASCOM Platform (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Platform\Platform Installation Date, $DATE$ $TIME$
Write Registry Key HKLM\SOFTWARE\ASCOM\Platform\Platform Name, $TITLE$
Write Registry Key HKLM\SOFTWARE\ASCOM\Platform\Platform Product Code, $PRODUCTCODE$
Write Registry Key HKLM\SOFTWARE\ASCOM\Platform\Platform Revision Code, $REVISIONCODE$
Write Registry Key HKLM\SOFTWARE\ASCOM\Platform\Platform Version, $VERSION$
Write Registry Key HKLM\SOFTWARE\ASCOM\Rotator Drivers\,  (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\SafetyMonitor Drivers\,  (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Switch Drivers\,  (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Switch Drivers\SwitchSim.Switch\, Simulator (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Telescope Drivers\,  (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Telescope Drivers\ASCOMDome.Telescope\\, ASCOM Dome Control (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Telescope Drivers\Hub.Telescope\\, Generic Hub (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Telescope Drivers\POTH.Telescope\\, POTH Hub (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Telescope Drivers\Pipe.Telescope\\, Pipe diagnostic tool (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Telescope Drivers\ScopeSim.Telescope\\, Simulator (permanent)
Write Registry Key HKLM\SOFTWARE\ASCOM\Video Drivers\,  (permanent)
[END REGION]
 
[DEFINE REGION: Create shortcuts]
Comment: Create menu shortcuts - Do this after the main MSI install has run so we pick up correct icons from applications
Write into Text File $SETUPLOG$ from Value $TIME$ Creating shortcuts in native mode (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ DesktopFolder: $DESKTOPFOLDER$ (at end of file)
Write into Text File $SETUPLOG$ from Value $TIME$ ShortcutFolder: $SHORTCUTFOLDER$ (at end of file)
Write into Text File $SETUPLOG$ from Value  (at end of file)
if Variable INSTALL_DIAGNOSTICS_SHORTCUT_ON_DESKTOP Equals TRUE
  Create Shortcut $DESKTOPFOLDER$\ASCOM Diagnostics to $TARGETDIR$\Tools\ASCOM Diagnostics.exe
end
if Variable INSTALL_PROFILE_EXPLORER_SHORTCUT_ON_DESKTOP Equals TRUE
  Create Shortcut $DESKTOPFOLDER$\ProfileExplorer to $TARGETDIR$\Tools\ProfileExplorer.exe
end
 
Comment: Shortcuts have to be created in native mode in order to get the ASCOM shortcut icon to appear
Set Variable NATIVE_ENGINE to TRUE
Create Shortcut $SHORTCUTFOLDER$\Tools\ObservingConditions SimulatorTester to $COMMONFILES$\ASCOM\ObservingConditions\Simulator\ASCOM.OCSimulator.Test.exe
Create Shortcut $SHORTCUTFOLDER$\Tools\ObservingConditions Hub Tester to $COMMONFILES$\ASCOM\ObservingConditions\OCH\ASCOM.OCH.Test.exe
Create Shortcut $SHORTCUTFOLDER$\ASCOM Compatible Software to http://ascom-standards.org/Community/Partners.htm
Create Shortcut $SHORTCUTFOLDER$\ASCOM Drivers and Downloads to http://www.ascom-standards.org/Downloads/Index.htm
Create Shortcut $SHORTCUTFOLDER$\ASCOM User Guide to $TARGETDIR$\Docs\ASCOM User Guide.pdf
Create Shortcut $SHORTCUTFOLDER$\Check for Updates to $TARGETDIR$\Tools\CheckForUpdates.js
Create Shortcut $SHORTCUTFOLDER$\Help and Device Interface Standards to $TARGETDIR$\Docs\PlatformHelp.chm
Create Shortcut $SHORTCUTFOLDER$\How to get support to http://ascom-standards.org/Support/index.htm
Create Shortcut $SHORTCUTFOLDER$\Show Platform Version to $COMMONFILES$\ASCOM\ShowPlatformVersion.vbs
Create Shortcut $SHORTCUTFOLDER$\Tools\Profile Explorer to $TARGETDIR$\Tools\ProfileExplorer.exe
Create Shortcut $SHORTCUTFOLDER$\Tools\ASCOM Diagnostics to $TARGETDIR$\Tools\ASCOM Diagnostics.exe
Create Shortcut $SHORTCUTFOLDER$\Simulators\Dome Simulator to $COMMONFILES$\ASCOM\Dome\DomeSim.exe
Create Shortcut $SHORTCUTFOLDER$\Simulators\FilterWheel Simulator to $COMMONFILES$\ASCOM\FilterWheel\FilterWheelSim.exe
Create Shortcut $SHORTCUTFOLDER$\Simulators\FilterWheel Simulator .NET to $COMMONFILES$\ASCOM\FilterWheel\ASCOM.FilterWheelSim\ASCOM.FilterWheelSim.exe
Create Shortcut $SHORTCUTFOLDER$\Simulators\Focus Simulator to $COMMONFILES$\ASCOM\Focuser\FocusSim.exe
Create Shortcut $SHORTCUTFOLDER$\Simulators\Rotator Simulator .NET to $COMMONFILES$\ASCOM\Rotator\ASCOM.RotatorSimulator\ASCOM.RotatorSimulator.exe
Create Shortcut $SHORTCUTFOLDER$\Simulators\Switch Simulator to $COMMONFILES$\ASCOM\Switch\SwitchSim.exe
Create Shortcut $SHORTCUTFOLDER$\Simulators\Telescope Simulator to $COMMONFILES$\ASCOM\Telescope\ScopeSim.exe
Create Shortcut $SHORTCUTFOLDER$\Simulators\Telescope Simulator .NET to $COMMONFILES$\ASCOM\Telescope\ASCOM.TelescopeSimulator\ASCOM.TelescopeSimulator.exe
if Variable INSTALL_PIPE Equals TRUE
  Create Shortcut $SHORTCUTFOLDER$\Tools\Pipe Connection Monitor to $COMMONFILES$\ASCOM\Telescope\Pipe.exe
  Create Shortcut $SHORTCUTFOLDER$\Tools\Pipe Help to $COMMONFILES$\ASCOM\Telescope\PipeHubHelp.htm
else
  Delete Files $SHORTCUTFOLDER$\Tools\Pipe Connection Monitor.lnk" (when installing)
  Delete Files $SHORTCUTFOLDER$\Tools\Pipe Help.lnk" (when installing)
end
if Variable INSTALL_POTH Equals TRUE
  Create Shortcut $SHORTCUTFOLDER$\Scope-Dome Hubs\POTH Scope-Dome Hub to $COMMONFILES$\ASCOM\Telescope\POTH.exe
  Create Shortcut $SHORTCUTFOLDER$\Scope-Dome Hubs\POTH Help to $COMMONFILES$\ASCOM\Telescope\POTHHelp.htm
else
  Delete Files $SHORTCUTFOLDER$\Scope-Dome Hubs\POTH Scope-Dome Hub.lnk" (when installing)
  Delete Files $SHORTCUTFOLDER$\Scope-Dome Hubs\POTH Help.lnk" (when installing)
end
if Variable INSTALL_DOMECONTROLHUB Equals TRUE
  Create Shortcut $SHORTCUTFOLDER$\Scope-Dome Hubs\ASCOM Dome Control to $COMMONFILES$\ASCOM\Dome\ASCOMDome.exe
else
  Delete Files $SHORTCUTFOLDER$\Scope-Dome Hubs\ASCOM Dome Control.lnk" (when installing)
end
Create Shortcut $SHORTCUTFOLDER$\Scope-Dome Hubs\ASCOM Device Hub to $COMMONFILES$\ASCOM\DeviceHub\ASCOM.DeviceHub.exe
Create Shortcut $SHORTCUTFOLDER$\Scope-Dome Hubs\ASCOM Device Hub Help to $COMMONFILES$\ASCOM\DeviceHub\ASCOM Device Hub User and Technical Information.pdf
Set Variable NATIVE_ENGINE to FALSE
 
[END REGION]
 
[DEFINE REGION: Specify additional clean-up required when uninstalling]
Comment: Remove TLB files created by RegAsm when application is uninstalled
Delete Files $COMMONFILES$\ASCOM\Camera\ASCOM.Simulator.Camera\*.tlb (when uninstalling)
Delete Files $COMMONFILES$\ASCOM\Focuser\ASCOM.Simulator.Focuser\*.tlb (when uninstalling)
Delete Files $COMMONFILES$\ASCOM\SafetyMonitor\ASCOM.Simulator.SafetyMonitor\*.tlb (when uninstalling)
Delete Files $COMMONFILES$\ASCOM\Video\ASCOM.Simulator.Video\*.tlb (when uninstalling)
Delete Files $COMMONFILES$\ASCOM\ObservingConditions\OpenWeatherMap\*.tlb (when uninstalling)
Delete Files $TARGETDIR$\Tools\*.avi (when uninstalling)
 
[END REGION]
 
Comment: Run the installation
Apply Install (get result into variable SUCCESS)
 
Comment: Save the installation success value and log status outcomes
Set Variable MYPROGRESS to 20
Write into Text File $SETUPLOG$ from Value $TIME$ Apply Install - Success:  $SUCCESS$, LastError: $LASTERROR$ (at end of file)
Write into Text File $SETUPLOG$ from Value  (at end of file)
 
Comment: Process COM registrations and other activities if the MSI install was successful
if Variable SUCCESS not Equals ERROR
   
  [DEFINE REGION: Non-MSI installation activities]
  Comment: Register Platform 5 components
  Set Variable MYPROGRESS to 21
  Set Variable PROGRESSTEXT to Registering assembly ASCOM.Helper 1.0.0.0
  Register assembly ASCOM.Helper, Version=1.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable MYPROGRESS to 22
  Set Variable PROGRESSTEXT to Registering assembly ASCOM.Helper2 1.0.0.0
  Register assembly ASCOM.Helper2, Version=1.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable MYPROGRESS to 23
  Set Variable PROGRESSTEXT to Registering assembly ASCOM.Interfaces 1.0.0.0
  Register assembly ASCOM.Interfaces, Version=1.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
   
  Comment: Register the Platform 5 type libraries
  Set Variable MYPROGRESS to 24
  Set Variable PROGRESSTEXT to Registering AscomMaterInterfaces typelib
  Run Program $COMMONFILES$\ASCOM\Platform\internal\regtlb.exe "$COMMONFILES$\ASCOM\Interface\AscomMasterInterfaces.tlb" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegTLB - ASCOMMasterInterfaces (at end of file)
  Set Variable MYPROGRESS to 25
  Set Variable PROGRESSTEXT to Registering ASCOM.Helper typelib
  Run Program $COMMONFILES$\ASCOM\Platform\internal\regtlb.exe "$COMMONFILES$\ASCOM\Interface\Helper.tlb" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegTLB - Helper (at end of file)
  Set Variable MYPROGRESS to 26
  Set Variable PROGRESSTEXT to Registering ASCOM.Helper2 typelib
  Run Program $COMMONFILES$\ASCOM\Platform\internal\regtlb.exe "$COMMONFILES$\ASCOM\Interface\Helper2.tlb" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegTLB - Helper2 (at end of file)
  Set Variable MYPROGRESS to 26
  Set Variable PROGRESSTEXT to Registering IObjectSafety typelib
  Run Program $COMMONFILES$\ASCOM\Platform\internal\regtlb.exe "$COMMONFILES$\ASCOM\Interface\IObjectSafety.tlb" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegTLB - IObjectSafety (at end of file)
   
  Comment: Register Platform 5 Simulators
  Set Variable MYPROGRESS to 27
  Set Variable PROGRESSTEXT to Registering Platform 5 Telescope simulator
  Run Program $COMMONFILES$\ASCOM\Telescope\ScopeSim.exe /regserver (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - ScopeSim (at end of file)
  Set Variable MYPROGRESS to 28
  if Variable INSTALL_HUB Equals TRUE
    Set Variable PROGRESSTEXT to Registering Hub server
    Run Program $COMMONFILES$\ASCOM\Telescope\Hub.exe /regserver (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - Hub (at end of file)
    Set Variable MYPROGRESS to 29
  end
  if Variable INSTALL_PIPE Equals TRUE
    Set Variable PROGRESSTEXT to Registering Pipe server
    Run Program $COMMONFILES$\ASCOM\Telescope\Pipe.exe /regserver (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - Pipe (at end of file)
    Set Variable MYPROGRESS to 30
  end
  if Variable INSTALL_POTH Equals TRUE
    Set Variable PROGRESSTEXT to Registering POTH server
    Run Program $COMMONFILES$\ASCOM\Telescope\POTH.exe /regserver (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - POTH (at end of file)
    Set Variable MYPROGRESS to 31
  end
  Set Variable PROGRESSTEXT to Registering Platform 5 Dome simulator
  Run Program $COMMONFILES$\ASCOM\Dome\DomeSim.exe /regserver (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - DomeSim (at end of file)
  Set Variable MYPROGRESS to 32
  if Variable INSTALL_DOMECONTROLHUB Equals TRUE
    Set Variable PROGRESSTEXT to Registering Platform 5 Dome Hub
    Run Program $COMMONFILES$\ASCOM\Dome\ASCOMDome.exe /regserver (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - ASCOMDome (at end of file)
  end
  Set Variable MYPROGRESS to 33
  Set Variable PROGRESSTEXT to Registering Platform 5 FilterWheel simulator
  Run Program $COMMONFILES$\ASCOM\FilterWheel\FilterWheelSim.exe /regserver (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - FilterWheelSim (at end of file)
  Set Variable MYPROGRESS to 34
  Set Variable PROGRESSTEXT to Registering Platform 5 Focuser simulator
  Run Program $COMMONFILES$\ASCOM\Focuser\FocusSim.exe /regserver (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - FocusSim (at end of file)
  Set Variable MYPROGRESS to 35
  Set Variable PROGRESSTEXT to Registering Platform 5 Switch simulator
  Run Program $COMMONFILES$\ASCOM\Switch\SwitchSim.exe /regserver (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - SwitchSim (at end of file)
   
  Comment: Register Platform 5.5 components
  Set Variable MYPROGRESS to 36
  Set Variable PROGRESSTEXT to Registering ASCOM.Astrometry 5.5.6.0
  Register assembly ASCOM.Astrometry, Version=5.5.6.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable MYPROGRESS to 37
  Set Variable MYPROGRESS to 38
  Set Variable PROGRESSTEXT to Registering ASCOM.Utilities 5.5.6.0
  Register assembly ASCOM.Utilities, Version=5.5.6.0, Culture=neutral, PublicKeyToken=565de7938946fba7
   
  Comment: Install policy files
  Set Variable MYPROGRESS to 39
  Set Variable PROGRESSTEXT to Installing policy.5.5.ASCOM.Utilities
  Run Program $COMMONFILES$\ASCOM\Platform\Internal\ASCOM.Internal.GACInstall.exe policy.5.5.ASCOM.Utilities.dll, startup in folder $COMMONFILES$\ASCOM\Platform\v5.5 (WAIT, get result into variable GACINSTALLRC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $GACINSTALLRC$ GACInstall - Utilities (at end of file)
  if Variable GACINSTALLRC not Equals 0
    MessageBalloon: GACInstall, Utilities install error RC: $GACINSTALLRC$
  end
  Set Variable MYPROGRESS to 40
  Set Variable PROGRESSTEXT to Installing policy.5.5.ASCOM.Astrometry
  Run Program $COMMONFILES$\ASCOM\Platform\Internal\ASCOM.Internal.GACInstall.exe policy.5.5.ASCOM.Astrometry.dll, startup in folder $COMMONFILES$\ASCOM\Platform\v5.5 (WAIT, get result into variable GACINSTALLRC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $GACINSTALLRC$ GACInstall - Astrometry Policy (at end of file)
  if Variable GACINSTALLRC not Equals 0
    MessageBalloon: GACInstall, Astrometry install error RC: $GACINSTALLRC$
  end
  Set Variable MYPROGRESS to 41
  Set Variable PROGRESSTEXT to Installing policy.1.0.ASCOM.DriverAccess
  Run Program $COMMONFILES$\ASCOM\Platform\Internal\ASCOM.Internal.GACInstall.exe policy.1.0.ASCOM.DriverAccess.dll, startup in folder $COMMONFILES$\ASCOM\Platform\v5.5 (WAIT, get result into variable GACINSTALLRC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $GACINSTALLRC$ GACInstall - DriverAccess Policy (at end of file)
  if Variable GACINSTALLRC not Equals 0
    MessageBalloon: GACInstall, DriverAccess install error RC: $GACINSTALLRC$
  end
  Set Variable MYPROGRESS to 42
  Set Variable PROGRESSTEXT to Installing policy.1.0.ASCOM.Exceptions
  Run Program $COMMONFILES$\ASCOM\Platform\Internal\ASCOM.Internal.GACInstall.exe policy.1.0.ASCOM.Exceptions.dll, startup in folder $COMMONFILES$\ASCOM\Platform\v6.0 (WAIT, get result into variable GACINSTALLRC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $GACINSTALLRC$ GACInstall - Exceptions Policy 1.0 (at end of file)
  if Variable GACINSTALLRC not Equals 0
    MessageBalloon: GACInstall, Exceptions 1.0 install error RC: $GACINSTALLRC$
  end
  Set Variable MYPROGRESS to 43
  Set Variable PROGRESSTEXT to Installing policy.1.1.ASCOM.Exceptions
  Run Program $COMMONFILES$\ASCOM\Platform\Internal\ASCOM.Internal.GACInstall.exe policy.1.1.ASCOM.Exceptions.dll, startup in folder $COMMONFILES$\ASCOM\Platform\v6.0 (WAIT, get result into variable GACINSTALLRC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $GACINSTALLRC$ GACInstall - Exceptions Policy 1.1 (at end of file)
  if Variable GACINSTALLRC not Equals 0
    MessageBalloon: GACInstall, Exceptions 1.1 install error RC: $GACINSTALLRC$
  end
   
  Comment: I'm sorry, I know this is an unforgiveable hack but I can't see any other way to have more than one pdb on the system. Peter
  Set Variable MYPROGRESS to 44
  Set Variable PROGRESSTEXT to Installing ASCOM.Utilities debug information
  Run Program $WINSYSDIR$\Cmd.exe /c copy ASCOM.Utilities.pdb $WINDIR$\assembly\GAC_MSIL\ASCOM.Utilities\5.5.6.0__565de7938946fba7, startup in folder $COMMONFILES$\ASCOM\Platform\v5.5 (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Copy - Utilities 5.5.6 (at end of file)
  Set Variable MYPROGRESS to 45
  Set Variable PROGRESSTEXT to Installing ASCOM.Astrometry debug information
  Run Program $WINSYSDIR$\Cmd.exe /c copy ASCOM.Astrometry.pdb $WINDIR$\assembly\GAC_MSIL\ASCOM.Astrometry\5.5.6.0__565de7938946fba7, startup in folder $COMMONFILES$\ASCOM\Platform\v5.5 (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Copy - Astrometry 5.5.6 (at end of file)
  Set Variable MYPROGRESS to 46
  Set Variable PROGRESSTEXT to Installing ASCOM.Atributes debug information
  Run Program $WINSYSDIR$\Cmd.exe /c copy ASCOM.Attributes.pdb $WINDIR$\assembly\GAC_MSIL\ASCOM.Attributes\5.5.0.0__565de7938946fba7, startup in folder $COMMONFILES$\ASCOM\Platform\v5.5 (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Copy - Attributes 5.5.0 (at end of file)
   
  Comment: Register Platform 6 components
  Set Variable MYPROGRESS to 47
  Set Variable PROGRESSTEXT to Registering ASCOM.Astrometry 6.0.0.0
  Register assembly ASCOM.Astrometry, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable MYPROGRESS to 48
  Set Variable PROGRESSTEXT to Registering ASCOM.Exceptions 6.0.0.0
  Register assembly ASCOM.Exceptions, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable MYPROGRESS to 49
  Set Variable PROGRESSTEXT to Registering ASCOM.Utilities 6.0.0.0
  Register assembly ASCOM.Utilities, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable PROGRESSTEXT to Registering ASCOM.DeviceInterface 6.0.0.0
  Register assembly ASCOM.DeviceInterface, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable MYPROGRESS to 50
  Set Variable PROGRESSTEXT to Registering ASCOM.Utilities.Video 6.1.0.0
  Register assembly ASCOM.Utilities.Video, Version=6.1.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
  Set Variable MYPROGRESS to 51
  Set Variable PROGRESSTEXT to Registering ASCOM.Cache 6.0.0.0
  Register assembly ASCOM.Cache, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7
   
  Comment: Register in-process simulator DLL files with Codebase option
  Set Variable MYPROGRESS to 52
  Set Variable PROGRESSTEXT to Registering Platform 6 Camera simulator
  Register assembly $COMMONFILES$\ASCOM\Camera\ASCOM.Simulator.Camera\ASCOM.Simulator.Camera.dll, set the code base in the registry
  Set Variable MYPROGRESS to 53
  Set Variable PROGRESSTEXT to Registering Platform 6 Focuser simulator
  Register assembly $COMMONFILES$\ASCOM\Focuser\ASCOM.Simulator.Focuser\ASCOM.Simulator.Focuser.dll, set the code base in the registry
  Set Variable PROGRESSTEXT to Registering Platform 6 CoverCalibrator simulator
  Register assembly $COMMONFILES$\ASCOM\CoverCalibrator\ASCOM.Simulator.CoverCalibrator\ASCOM.Simulator.CoverCalibrator.dll, set the code base in the registry
  Set Variable MYPROGRESS to 54
  Set Variable PROGRESSTEXT to Registering Platform 6 SafetyMonitor simulator
  Register assembly $COMMONFILES$\ASCOM\SafetyMonitor\ASCOM.Simulator.SafetyMonitor\ASCOM.Simulator.SafetyMonitor.dll, set the code base in the registry
  Set Variable MYPROGRESS to 55
  Set Variable PROGRESSTEXT to Registering Platform 6 Dome simulator
  Register assembly $COMMONFILES$\ASCOM\Dome\ASCOM.Simulator.Dome\ASCOM.Simulator.Dome.dll, set the code base in the registry
  Set Variable MYPROGRESS to 56
  Set Variable PROGRESSTEXT to Registering Platform 6 Video simulator
  Register assembly $COMMONFILES$\ASCOM\Video\ASCOM.Simulator.Video\ASCOM.Simulator.Video.dll, set the code base in the registry
  Set Variable MYPROGRESS to 57
  Set Variable PROGRESSTEXT to Registering Platform 6 OpenWeatherMap simulator
  Register assembly $COMMONFILES$\ASCOM\ObservingConditions\OpenWeatherMap\ASCOM.OpenWeatherMap.ObservingConditions.dll, set the code base in the registry
   
  Comment: Register these LocalServer drivers using the -register option
  Set Variable MYPROGRESS to 58
  Set Variable PROGRESSTEXT to Registering Platform 6 FilterWheel simulator
  Run Program $COMMONFILES$\ASCOM\FilterWheel\ASCOM.FilterWheelSim\ASCOM.FilterWheelSim.exe -register (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - FilterWheel Simulator 6 (at end of file)
  Set Variable MYPROGRESS to 59
  Set Variable PROGRESSTEXT to Registering Platform 6 Rotator simulator
  Run Program $COMMONFILES$\ASCOM\Rotator\ASCOM.RotatorSimulator\ASCOM.RotatorSimulator.exe -register (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - Rotator Simulator 6 (at end of file)
  Set Variable MYPROGRESS to 60
  Set Variable PROGRESSTEXT to Registering Platform 6 Switch simulator
  Run Program $COMMONFILES$\ASCOM\Switch\Switch V2\ASCOM.Simulator.Server.exe -register (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - Switch V2 Simulator (at end of file)
  Set Variable MYPROGRESS to 61
  Set Variable PROGRESSTEXT to Registering Platform 6 Telescope simulator
  Run Program $COMMONFILES$\ASCOM\Telescope\ASCOM.TelescopeSimulator\ASCOM.TelescopeSimulator.exe -register (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - Telescope Simulator 6 (at end of file)
  Set Variable MYPROGRESS to 62
  Set Variable PROGRESSTEXT to Registering Platform 6 ObservingConditions simulator
  Run Program $COMMONFILES$\ASCOM\ObservingConditions\Simulator\ASCOM.OCSimulator.Server.exe -register (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - Observing Conditions Simulator (at end of file)
  Set Variable MYPROGRESS to 63
  Set Variable PROGRESSTEXT to Registering Platform 6 Observing Conditions Hub
  Run Program $COMMONFILES$\ASCOM\ObservingConditions\OCH\ASCOM.OCH.Server.exe -register (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - Observing Conditions Hub (at end of file)
  Set Variable PROGRESSTEXT to Registering Platform 6 Device Hub
  Run Program $COMMONFILES$\ASCOM\DeviceHub\ASCOM.DeviceHub.exe -register (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Register - Device Hub (at end of file)
   
   
  Comment: Install 32bit native images
  Set Variable MYPROGRESS to 64
  Set Variable PROGRESSTEXT to Creating 32bit native images - ASCOM.DeviceInterfaces - v6.0.0.0
  Run Program $NGEN32$ "ASCOM.DeviceInterfaces, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Install - DeviceInterfaces 6 (at end of file)
  Set Variable MYPROGRESS to 65
  Set Variable PROGRESSTEXT to Creating 32bit native images - ASCOM.Helper - v1.0.0.0
  Run Program $NGEN32$ "ASCOM.Helper, Version=1.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Install - ASCOM Helper (at end of file)
  Set Variable MYPROGRESS to 66
  Set Variable PROGRESSTEXT to Creating 32bit native images - ASCOM.Utilities - v6.0.0.0
  Run Program $NGEN32$ "ASCOM.Utilities, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Install - Utilities 6 (at end of file)
  Set Variable MYPROGRESS to 67
  Set Variable PROGRESSTEXT to Creating 32bit native images - ASCOM.Utilities.Video - v6.1.0.0
  Run Program $NGEN32$ "ASCOM.Utilities.Video, Version=6.1.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Install - VideoUtils 6.1 (at end of file)
  Set Variable MYPROGRESS to 68
  Set Variable PROGRESSTEXT to Creating 32bit native images - ASCOM.Astrometry - v5.5.6.0
  Run Program $NGEN32$ "ASCOM.Astrometry, Version=5.5.6.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Install - Astrometry 5.5.6 (at end of file)
  Set Variable MYPROGRESS to 69
  Set Variable PROGRESSTEXT to Creating 32bit native images - ASCOM.Astrometry - v6.0.0.0
  Run Program $NGEN32$ "ASCOM.Astrometry, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Install - Astrometry 6 (at end of file)
  Set Variable MYPROGRESS to 70
  Set Variable PROGRESSTEXT to Creating 32bit native images - ASCOM.DriverAccess - v6.0.0.0
  Run Program $NGEN32$ "ASCOM.DriverAccess, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Install - DriverAccess 6 (at end of file)
  Set Variable MYPROGRESS to 71
  Set Variable PROGRESSTEXT to Creating 32bit native images - ASCOM.Helper2 - v1.0.0.0
  Run Program $NGEN32$ "ASCOM.Helper2, Version=1.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Install - Helper2 1.0 (at end of file)
  Set Variable MYPROGRESS to 72
  Set Variable PROGRESSTEXT to Creating 32bit native images - ASCOM.Exceptions - v6.0.0.0
  Run Program $NGEN32$ "ASCOM.Exceptions, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Install - Exceptions 6 (at end of file)
  Set Variable MYPROGRESS to 73
  Set Variable PROGRESSTEXT to Creating 32bit native images - DirectShowLib-2005 - v2.1.0.15637
  Run Program $NGEN32$ "DirectShowLib-2005, Version=2.1.0.15637, Culture=neutral, PublicKeyToken=67e7b740cdfc2d3f" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Install - DirectShowLib 2.1 (at end of file)
  Set Variable MYPROGRESS to 74
  Set Variable PROGRESSTEXT to Creating 32bit native images - ASCOM.Cache - v6.0.0.0
  Run Program $NGEN32$ "ASCOM.Cache, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Install - ASCOM Cache (at end of file)
  Set Variable PROGRESSTEXT to Creating 32bit native images - ASCOM.Support.Utilities - v6.0.0.0
  Comment: Run Program $NGEN32$ "ASCOM.Utilities.Support, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Comment: Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Install - ASCOM Support Utilities (at end of file)
  Set Variable PROGRESSTEXT to Creating 32bit native images - ASCOM.Newtonsoft.Json- v6.0.0.0
  Run Program $NGEN32$ "ASCOM.Newtonsoft.Json, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen32 Install - ASCOM Newtonsoft JSON Support (at end of file)
   
  Set Variable PROGRESSTEXT to Initialising earth rotation data
  Run Program $TARGETDIR$\Tools\EarthRotationUpdate.exe /Initialise (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ Initialise earth rotation data (at end of file)
  if Variable RC not Equals 0
    MessageBox: Initialise Earth Rotation Data, An error has occured while initialising the earth rotation data scheduled task, please save all logs in My Documents\ASCOM... and report this on the ASCOM-Talk Groups.Io forum.
    if Variable ASCOMERROR not Equals 
      Set Variable ASCOMERROR to $ASCOMERROR$$NEWLINE$
    end
    Set Variable ASCOMERROR to $ASCOMERROR$Earth rotation data scheduled job issue. RC: $RC$
  end
   
  [DEFINE REGION: Extra activities if on a 64bit system]
  Comment: Extra registration of 64bit components if on 64bit system
  if Variable WIN64MODE Equals TRUE
     
    Set x64 - Native 64 bit Windows, AMD64, EM64T, and ARM64 Architectures - installation mode
    Comment: Register core components
    Set Variable MYPROGRESS to 75
    Set Variable PROGRESSTEXT to Registering 64bit ASCOM.Astrometry.dll for COM
    Run Program $REGASM64$ "$COMMONFILES$\ASCOM\Platform\v6\ASCOM.Astrometry.dll" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm64 - Astrometry (at end of file)
    if Variable RC not Equals 0
      MessageBalloon: RegAsm 64, Unable to register the ASCOM.Astrometry assembly for 64bit operation. RC: $RC$
    end
    Set Variable MYPROGRESS to 76
    Set Variable PROGRESSTEXT to Registering 64bit ASCOM.Exceptions.dll for COM
    Run Program $REGASM64$ "$COMMONFILES$\ASCOM\Platform\v6\ASCOM.Exceptions.dll" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm64 - Exceptions (at end of file)
    if Variable RC not Equals 0
      MessageBalloon: RegAsm 64, Unable to register the ASCOM.Exceptions assembly for 64bit operation. RC: $RC$
    end
    Set Variable MYPROGRESS to 77
    Set Variable PROGRESSTEXT to Registering 64bit ASCOM.Utilities.dll for COM
    Run Program $REGASM64$ "$COMMONFILES$\ASCOM\Platform\v6\ASCOM.Utilities.dll" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm64 - Utilities (at end of file)
    if Variable RC not Equals 0
      MessageBalloon: RegAsm 64, Unable to register the ASCOM.Utilities assembly for 64bit operation. RC: $RC$
    end
    Set Variable PROGRESSTEXT to Registering 64bit ASCOM.Deviceinterfaces.dll for COM
    Run Program $REGASM64$ "$COMMONFILES$\ASCOM\Platform\v6\ASCOM.Deviceinterfaces.dll" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm64 - Deviceinterfaces (at end of file)
    if Variable RC not Equals 0
      MessageBalloon: RegAsm 64, Unable to register the ASCOM.Deviceinterfaces assembly for 64bit operation. RC: $RC$
    end
    Set Variable MYPROGRESS to 78
    Set Variable PROGRESSTEXT to Registering 64bit ASCOM.Utilities.Video.dll for COM
    Run Program $REGASM64$ "$COMMONFILES$\ASCOM\Platform\v6.1\ASCOM.Utilities.Video.dll" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm64 - Video Utilities (at end of file)
    if Variable RC not Equals 0
      MessageBalloon: RegAsm 64, Unable to register the ASCOM.Utilites.Video assembly for 64bit operation. RC: $RC$
    end
    Set Variable MYPROGRESS to 79
    Set Variable PROGRESSTEXT to Registering 64bit ASCOM.Cache.dll for COM
    Run Program $REGASM64$ "$COMMONFILES$\ASCOM\Platform\v6.4\ASCOM.Cache.dll" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm64 - ASCOM Cache (at end of file)
    if Variable RC not Equals 0
      MessageBalloon: RegAsm 64, Unable to register the ASCOM.Cache assembly for 64bit operation. RC: $RC$
    end
     
    Comment: Register simulators
    Set Variable MYPROGRESS to 80
    Set Variable PROGRESSTEXT to Registering Platform 6 Camera simulator
    Run Program $REGASM64$ "$COMMONFILES$\ASCOM\Camera\ASCOM.Simulator.Camera\ASCOM.Simulator.Camera.dll" /codebase (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm64 - Camera Simulator 6 (at end of file)
    if Variable RC not Equals 0
      MessageBalloon: RegAsm 64, Unable to register the ASCOM Camera simulator for 64bit operation. RC: $RC$
    end
    Set Variable MYPROGRESS to 81
    Set Variable PROGRESSTEXT to Registering Platform 6 Focuser simulator
    Run Program $REGASM64$ "$COMMONFILES$\ASCOM\Focuser\ASCOM.Simulator.Focuser\ASCOM.Simulator.Focuser.dll" /codebase (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm64 - Focus Simulator 6 (at end of file)
    if Variable RC not Equals 0
      MessageBalloon: RegAsm 64, Unable to register the ASCOM Focuser simulator for 64bit operation. RC: $RC$
      if Variable ASCOMERROR not Equals 
        Set Variable ASCOMERROR to $ASCOMERROR$$NEWLINE$
      end
      Set Variable ASCOMERROR to $ASCOMERROR$Focuser simulator 64bit registration failed. RC: $RC$
    end
    Set Variable PROGRESSTEXT to Registering Platform 6 CoverCalibrator simulator
    Run Program $REGASM64$ "$COMMONFILES$\ASCOM\CoverCalibrator\ASCOM.Simulator.CoverCalibrator\ASCOM.Simulator.CoverCalibrator.dll" /codebase (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm64 - CoverCalibrator Simulator (at end of file)
    if Variable RC not Equals 0
      MessageBalloon: RegAsm 64, Unable to register the ASCOM CoverCalibrator simulator for 64bit operation. RC: $RC$
    end
    Set Variable MYPROGRESS to 82
    Set Variable PROGRESSTEXT to Registering Platform 6 Safety Monitor simulator
    Run Program $REGASM64$ "$COMMONFILES$\ASCOM\SafetyMonitor\ASCOM.Simulator.SafetyMonitor\ASCOM.Simulator.SafetyMonitor.dll" /codebase (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm64 - Safety Monitor Simulator 6 (at end of file)
    if Variable RC not Equals 0
      MessageBalloon: RegAsm 64, Unable to register the ASCOM Safety Monitor simulator for 64bit operation. RC: $RC$
    end
    Set Variable MYPROGRESS to 83
    Set Variable PROGRESSTEXT to Registering Platform 6 Dome simulator
    Run Program $REGASM64$ "$COMMONFILES$\ASCOM\Dome\ASCOM.Simulator.Dome\ASCOM.Simulator.Dome.dll" /codebase (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm64 - Dome Simulator 6 (at end of file)
    if Variable RC not Equals 0
      MessageBalloon: RegAsm 64, Unable to register the ASCOM Dome simulator for 64bit operation. RC: $RC$
    end
    Set Variable MYPROGRESS to 84
    Set Variable PROGRESSTEXT to Registering Platform 6 Video simulator
    Run Program $REGASM64$ "$COMMONFILES$\ASCOM\Video\ASCOM.Simulator.Video\ASCOM.Simulator.Video.dll" /codebase (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm64 - Video Simulator (at end of file)
    if Variable RC not Equals 0
      MessageBalloon: RegAsm 64, Unable to register the ASCOM Video simulator for 64bit operation. RC: $RC$
    end
    Set Variable MYPROGRESS to 85
    Set Variable PROGRESSTEXT to Registering Platform 6 Open Weathermap Driver
    Run Program $REGASM64$ "$COMMONFILES$\ASCOM\ObservingConditions\OpenWeatherMap\ASCOM.OpenWeatherMap.ObservingConditions.dll" /codebase (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ RegAsm64 - Open Weather Map Driver (at end of file)
    if Variable RC not Equals 0
      MessageBalloon: RegAsm 64, Unable to register the ASCOM Open Weathermap driver for 64bit operation. RC: $RC$
    end
     
    Comment: Create 64bit native images
    Set Variable MYPROGRESS to 86
    Set Variable PROGRESSTEXT to Creating 64bit native images - ASCOM.DeviceInterfaces - v6.0.0.0
    Run Program $NGEN64$ "ASCOM.DeviceInterfaces, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Install - DeviceInterfaces 6 (at end of file)
    Set Variable MYPROGRESS to 87
    Set Variable PROGRESSTEXT to Creating 64bit native images - ASCOM.DriverAccess - v6.0.0.0
    Run Program $NGEN64$ "ASCOM.DriverAccess, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Install - DriverAccess 6 (at end of file)
    Set Variable MYPROGRESS to 88
    Set Variable PROGRESSTEXT to Creating 64bit native images - ASCOM.Exceptions - v6.0.0.0
    Run Program $NGEN64$ "ASCOM.Exceptions, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Install - Exceptions 6 (at end of file)
    Set Variable MYPROGRESS to 89
    Set Variable PROGRESSTEXT to Creating 64bit native images - ASCOM.Utilities - v6.0.0.0
    Run Program $NGEN64$ "ASCOM.Utilities, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Install - Utilities 6 (at end of file)
    Set Variable MYPROGRESS to 90
    Set Variable PROGRESSTEXT to Creating 64bit native images - ASCOM.Utilities.Video - v6.1.0.0
    Run Program $NGEN64$ "ASCOM.Utilities.Video, Version=6.1.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Install - Video Utilities (at end of file)
    Set Variable MYPROGRESS to 91
    Set Variable PROGRESSTEXT to Creating 64bit native images - ASCOM.Astrometry - v5.5.6.0
    Run Program $NGEN64$ "ASCOM.Astrometry, Version=5.5.6.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Install - Astrometry 5.5.6 (at end of file)
    Set Variable MYPROGRESS to 92
    Set Variable PROGRESSTEXT to Creating 64bit native images - ASCOM.Astrometry - v6.0.0.0
    Run Program $NGEN64$ "ASCOM.Astrometry, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Install - Astrometry 6 (at end of file)
    Set Variable MYPROGRESS to 93
    Set Variable PROGRESSTEXT to Creating 64bit native images - DirectShowLib-2005 - v2.1.0.15637
    Run Program $NGEN64$ "DirectShowLib-2005, Version=2.1.0.15637, Culture=neutral, PublicKeyToken=67e7b740cdfc2d3f" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Install - DirectShowLib (at end of file)
    Set Variable MYPROGRESS to 94
    Set Variable PROGRESSTEXT to Creating 64bit native images - ASCOM.Cache - v6.0.0.0
    Run Program $NGEN64$ "ASCOM.Cache, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Install - ASCOM Cache (at end of file)
    Set Variable MYPROGRESS to 95
    Set Variable PROGRESSTEXT to Creating 64bit native images - ASCOM.Support.Utilities - v6.0.0.0
    Comment: Run Program $NGEN64$ "ASCOM.Utilities.Support, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Comment: Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Install - ASCOM Support Utilities (at end of file)
    Set Variable PROGRESSTEXT to Creating 64bit native images - ASCOM.Newtonsoft.Json- v6.0.0.0
    Run Program $NGEN64$ "ASCOM.Newtonsoft.Json, Version=6.0.0.0, Culture=neutral, PublicKeyToken=565de7938946fba7" (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ NGen64 Install - ASCOM Newtonsoft JSON Support (at end of file)
     
    Comment: Install additional Platform 5.5 files on 64 bit systems to make sure old 64bit mode driver installers continue to work
    Set Variable PROGRESSTEXT to Installing additional Platform 5.5 files required for 64bit systems
    Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\Platform 5.5\ASCOM.Utilities.dll to $COMMONFILES64$ASCOM\.net
    Install Files ..\..\..\..\ASCOM.DriverAccess.Platform5\bin\Release\ASCOM.DriverAccess.dll to $COMMONFILES64$ASCOM\.net
    Install Files ..\..\..\..\Releases\ASCOM 6\Platform\Files\Docs\These files are not in use - ReadMe.txt to $COMMONFILES64$ASCOM\.net
    Apply Install (get result into variable SUCCESS64)
    Set Win32 - Native 32 bit Windows and Windows 32 on Windows 64 (WOW64) - installation mode
  end
  [END REGION]
   
  Comment: Tidy up COM registration (add AppID for DCOM etc.) and finish
  Set Variable PROGRESSTEXT to Finalising install
  Run Program $SUPPORTDIR$\FinaliseInstall.exe  (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ FinaliseInstall (at end of file)
  Set Variable MYPROGRESS to 100
  if Variable RC not Equals 0
    MessageBox: Finalise Setup, An error has occured while finalising the installation, please save all logs in My Documents\ASCOM... and report this on the ASCOM-Talk Groups.Io forum.
    if Variable ASCOMERROR not Equals 
      Set Variable ASCOMERROR to $ASCOMERROR$$NEWLINE$
    end
    Set Variable ASCOMERROR to $ASCOMERROR$Finalise setup issue. RC: $RC$
  end
  [END REGION]
   
  Comment: Run basic 32bit Platform validation
  Set Variable PROGRESSTEXT to Validate 32bit Platform operation
  Run Program $TARGETDIR$\Tools\Validation\ValidatePlatform.exe  (WAIT, get result into variable RC)
  Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ ValidatePlatform (at end of file)
   
  Comment: Run basic 64bit Platform validation if we are running on a 64bit OS
  if Variable WIN64MODE Equals TRUE
    Set Variable PROGRESSTEXT to Validate 64bit Platform operation
    Run Program $TARGETDIR$\Tools\Validation\ValidatePlatform64.exe  (WAIT, get result into variable RC)
    Write into Text File $SETUPLOG$ from Value $TIME$ RC: $RC$ ValidatePlatform64 (at end of file)
  end
   
end
Set Variable MYPROGRESS to 100
 
[END REGION]
 
[DEFINE REGION: Finish Setup Dialogue]
label: Finish Setup
Hide Dialog
 
Comment: Set SUCCESS to REBOOT if either of the Visual C++ installers required it.
if Variable VC32_REBOOT_REQUIRED Equals (Ignore Case) TRUE
  Set Variable SUCCESS to REBOOT
end
if Variable VC64_REBOOT_REQUIRED Equals (Ignore Case) TRUE
  Set Variable SUCCESS to REBOOT
end
 
Comment: Initialise finish dialogue message display variables
Set Variable FINISH_TITLE to 
Set Variable FINISH_TITLE_POSITION to 
Set Variable FINISH_DESCRIPTION to 
Set Variable FINISH_CONTEXT to 
 
Comment: We Ensure that the SUCCESS variable reflects the overall ewrror state
if Variable ASCOMERROR not Equals 
  Comment: We have an ASCOM error so reflect this in the SUCCESS variable
  Set Variable SUCCESS to ERROR
end
Comment: Only show the User Guide if the installation competed properly
if Variable SUCCESS not Equals (Ignore Case) COMPLETE
  Comment: We do not have a normal comlete install so we don't want to show the user guide even if it was requested
  Set Variable DISPLAY_USER_GUIDE to FALSE
end
 
Comment: Test whether we have an error, if so then we just display the error messages
if Variable SUCCESS not Equals (Ignore Case) ERROR
  Comment: No errors - great!
  if Variable SUCCESS Equals (Ignore Case) CANCEL
    Comment: User requested installation cancel
    Set Variable FINISH_TITLE to Platform installation has been cancelled at your request.
  else
    if Variable SUCCESS Equals (Ignore Case) REBOOT
      Comment: At least one of the Visual C++ installers requires a reboot
      Set Variable FINISH_TITLE to $TITLE$ has been successfully installed.$NEWLINE$Your PC needs to be restarted to complete installation.
    else
      if Variable SUCCESS Equals (Ignore Case) COMPLETE
        Comment: Success and no reboot required!
        Set Variable FINISH_TITLE to $TITLE$ has been installed successfully.
        Set Variable FINISH_DESCRIPTION to  Congratulations, ASCOM Platform 6 installed successfully!$NEWLINE$$NEWLINE$ Please review the "Introduction" section of the Help file in$NEWLINE$ Start Menu / ASCOM Platform 6 for changes in this release.$NEWLINE$$NEWLINE$ If you experience issues after installing this release please run the$NEWLINE$ Diagnostics Tool in ASCOM Platform 6 / Tools and report them on$NEWLINE$ the ASCOM Talk Groups.Io forum.$NEWLINE$$NEWLINE$ Best wishes, The ASCOM Platform Team.
        if Variable DISPLAY_USER_GUIDE Equals (Ignore Case) TRUE
          Set Variable FINISH_CONTEXT to The user guide will be displayed after you click the Finish button
        end
        Comment: Revise messages if in maintenance mode
        if Variable MAINTENANCE Equals (Ignore Case) TRUE
          Set Variable FINISH_DESCRIPTION to 
          Set Variable FINISH_CONTEXT to 
          if Variable REMOVE Equals (Ignore Case) TRUE
            Comment: User requested uninstall
            Set Variable FINISH_TITLE to $TITLE$ has been uninstalled.
          end
          if Variable REPAIR Equals (Ignore Case) TRUE
            Comment: User requested repair
            Set Variable FINISH_TITLE to $TITLE$ has been repaired.
          end
          if Variable MODIFY Equals (Ignore Case) TRUE
            Comment: User requested change features
            Set Variable FINISH_TITLE to $TITLE$ has been modified as requested.
          end
        end
      else
        Comment: Unexpected value in SUCCESS variable
        Set Variable FINISH_TITLE to Unexpected SUCCESS Status Returned: $SUCCESS$!
        Set Variable FINISH_CONTEXT to The installation may or may not have completed successfully.$NEWLINE$Please report this on the Groups.Io ASCOM-Talk forum.
      end
    end
  end
else
  Comment: We have an error so set the error messages
  Set Variable FINISH_TITLE to $TITLE$ installation failed
  Set Variable FINISH_DESCRIPTION to An error occurred during installation of Platform 6.$NEWLINE$$NEWLINE$Please review the PlatformInstall, UninstallASCOM and FinaliseInstall $NEWLINE$logs in the My Documents\ASCOM and the most recent$NEWLINE$My Documents\ASCOM\Logs YYYY MM DD folders.$NEWLINE$$NEWLINE$Please also run the Diagnostics Tool in ASCOM Platform 6 / Tools and $NEWLINE$post all logs on the ASCOM Talk Groups.Io forum.$NEWLINE$$NEWLINE$Many thanks, The ASCOM Platform Team.
  Set Variable FINISH_CONTEXT to Last error: "$LASTERROR$"$NEWLINE$$ASCOMERROR$
end
 
Comment: Ensure that the variables are all upper case so that tests conducted within the dialogue fire correctly!
Convert Variable SUCCESS to UPPER case
Display Dialog: finish, wait for dialog to return (modal)
if Variable SILENT Equals FALSE
  if Variable REBOOTCOMPUTER Equals TRUE
    if Variable SUCCESS Equals REBOOT
      Reboot Computer
    end
  end
   
  Comment: Show the user guide if we are not removing and not repairing the install
  if Variable DISPLAY_USER_GUIDE Equals (Ignore Case) TRUE
    if Variable MAINTENANCE not Equals (Ignore Case) TRUE
      Comment: Display the user guide if Acrobat is installed
      if Variable ACROBATKEY not Equals 
        Comment: Acrobat is installed
        Write into Text File $SETUPLOG$ from Value $TIME$ UserGuide: Acrobat is installed - displaying guide (at end of file)
        Run Program $TARGETDIR$\Docs\ASCOM User Guide.pdf 
      else
        Comment: Acrobat is not installed so check whether we are running on Windows 10 i.e. the build number is > 9600
        if Variable OSCURRENTBUILD Greater Than 9600
          Comment: We are running on Windows 10 so run the program and leave it to the user to display it in the MS Edge browser or application of their choice
          Write into Text File $SETUPLOG$ from Value $TIME$ UserGuide: Acrobat is not installed but we are running on Windows 10 - displaying guide (at end of file)
          Run Program $TARGETDIR$\Docs\ASCOM User Guide.pdf 
        else
          Comment: We are not running on Windows 10 so display an error message.
          Write into Text File $SETUPLOG$ from Value $TIME$ UserGuide: Acrobat is not installed and we are not running on Windows 10 - showing cannot display message (at end of file)
          MessageBox: User Guide, Adobe Acrobat Reader does not appear to be installed on your $NEWLINE$system so we can not display the User Guide. $NEWLINE$$NEWLINE$Please install Acrobat Reader (its free) from www.adobe.com and $NEWLINE$access the guide from Start Menu / ASCOM Platform 6.
        end
      end
    end
  else
    Comment: User guide display not requested
    Write into Text File $SETUPLOG$ from Value $TIME$ UserGuide: User guide display not requested (at end of file)
  end
end
[END REGION]
label: End of Script
 
