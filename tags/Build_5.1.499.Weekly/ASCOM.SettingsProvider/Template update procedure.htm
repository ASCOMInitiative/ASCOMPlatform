<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>Untitled Page</title>
    <style type="text/css">
        .style1
        {
            font-weight: bold;
            text-decoration: underline;
        }
        .style2
        {
            font-family: Consolas;
        }
    </style>
</head>
<body>

    <h1>
        Updating Driver Templates to work with ASCOM.SettingsProvider</h1>
    <p>
        The following definitions apply:</p>
    <ul>
        <li>Items in &lt;angle brackets&gt; are placeholders that need to be substituted for 
            actual values.</li>
        <li>&lt;DeviceName&gt; is the model name of the ASCOM device, e.g. &quot;LX200&quot;, &quot;OptecTCF&quot;.</li>
        <li>&lt;DeviceCLass&gt; is the type of ASCOM device, e.g. &quot;Telescope&quot;, &quot;Dome&quot;, &quot;Camera&quot;, 
            etc.</li>
        <li>&lt;DeviceID&gt; is the full ASCOM Device ID (aka COM ClsID) of the device, e.g. 
            ASCOM.MyCCD.Camera.</li>
    </ul>
    <ol>
        <li>Create a new project by re-hydrating the Platform 5.0a template project. Name 
            the new project &quot;&lt;DeviceClass&gt;TemplateProject&quot; (no spaces or punctuation). 
            &quot;&lt;DeviceClass&gt;&quot; is to be substituted with the Device Class being generated, i.e. 
            Telescope, Dome, Camera, etc. and henceforth this forms the ASCOM <i>DeviceName</i> 
            for the project.</li>
        <li>Add SettingsProvider.cs or SettingsProvider.vb to the project. The file contents 
            should be as shown below, paying careful attention to the <span class="style1">bold underlined</span> identifiers:<br />
            <pre>using System.Configuration;
namespace <span class="style1">ASCOM.&lt;DeviceClass&gt;TemplateProject.Properties</span>
	{
	[SettingsProvider(typeof(ASCOM.SettingsProvider))]
	[ASCOM.DeviceId("<span class="style1">ASCOM.&lt;DeviceName&gt;.&lt;DeviceClass&gt;</span>")]
	internal sealed partial class Settings
		{
		// No code is defined here, but the partial class definition adds
		// the attributes to the code generated by Visual Studio and tells
		// the ApplicationSettings class to use ASCOM.SettingsProvider
		// to provide its underlying storage.
		}
	}</pre>
        </li>
        <li>Edit the project properties:<ol>
            <li><i><b>Application tab</b></i>: Set the assembly name and default namespace as 
                follows:<ol>
                    <li>Assembly Name: ASCOM.&lt;DeviceName&gt;.&lt;DeviceClass&gt;</li>
                    <li>Default Namespace: ASCOM.&lt;DeviceName&gt;</li>
                    <li>Set target framework to .NET Framework 3.5</li>
                </ol>
            </li>
            <li><i><b>Build tab</b></i>: Set the target architecture to &quot;Any CPU&quot;</li>
            <li><i><b>Settings tab</b></i>: create a setting named CommPortName, scope-User, 
                Default=COM1</li>
            </ol>
        </li>
        <li>Add references to the following .NET assemblies:<ol>
            <li>&nbsp;ASCOM.SettingsProvider; CopyLocal=false</li>
            <li>ASCOM.HelperNET; CopyLocal=false</li>
            <li>System.Configuration</li>
            </ol>
        </li>
        <li>Remove references to COM Interfaces:<ol>
            <li>Helper</li>
            <li>Helper2</li>
            </ol>
        </li>
        <li>Edit Driver.cs/vb<ol>
            <li>Remove using/imports directives for <b>ASCOM.Helper</b> and <b>ASCOM.Helper2</b></li>
            <li>Add using/imports directives for <b>ASCOM.HelperNet</b>, aliased to <b>Helper</b></li>
            <li>In <b>RegUnregASCOM()</b> method, replace reference to <b>P.DeviceTypeV</b> with
                <b>P.DeviceType</b>.</li>
            </ol>
        </li>
        <li>Edit the <i>SetupDialogForm.cs/vb</i> source file.<ol>
            <li>In the OK button handler <b>cmdOK_Click</b>(), add the following code:<br />
                <pre>		private void cmdOK_Click(object sender, EventArgs e)
		{
			Properties.Settings.Default.Save();
			Dispose();
		}</pre>
            <li>In the Cancel button handler, cmdCancel_Click(), add the following code:<br />
                <pre>		private void cmdCancel_Click(object sender, EventArgs e)
		{
			Properties.Settings.Default.Reload();
			Dispose();
		}</pre>
            </li>
            </ol>
        </li>
        <li>
            
            Edit the <i>SetupDialogForm.cs/vb</i> in the Forms Designer.<ol>
                <li>Add a label with text &quot;Comm Port&quot;</li>
                <li>Add a TextBox with name <b>txtCommPort</b></li>
                <li>Bind <b>txtCommPort.Text</b> to the <b>CommPortName</b> setting.</li>
            </ol>
            
        </li>
        <li>Edit the <i>ReadMe.htm</i> file.<ol>
            <li>Modify the last paragraph to read:<br />
        <p>
            <a name="footnote"></a><span class="style2">(note) If you're running on Windows 2000 or Windows Vista
            x64, you'll have to change the path to cscript.exe in your project properties, Debug
            tab, Start External Program.</span></p>
        <ul>
            <li class="style2">For Windows 2000, Change c:\windows\ to c:\winnt\.</li>
            <li class="style2">For Windows Vista x64, change <a href="file:///C:/Windows/System32">C:\Windows\System32</a>
                to <a href="file:///C:/Windows/SysWOW64">C:\Windows\SysWOW64</a>. </li>
        </ul>
            </li>
            </ol>
        </li>
        </ol>
            <p>
                &nbsp;</p>
            <h2>Export the template</h2>
            <ol>
                <li>Name the template &quot;ASCOM &lt;DeviceType&gt; Driver&quot;</li>
                <li>Assign either the C# or VB icon.</li>
                <li>Set the description to &quot;Create a new &lt;DeviceType&gt; driver. Name your project 
                after the device model, eg. MyCCD. The DeviceID will then be 
                ASCOM.MyCCD.Camera&quot;.</li>
            </ol>

</body>
</html>
